<?phpif($action=="download"){	include ("mysql_backup.php");		$backup_obj = new MySQL_Backup();	$backup_obj->server = $host[$_SERVER['HTTP_HOST']]['db_host'];	$backup_obj->username = $host[$_SERVER['HTTP_HOST']]['db_user'];	$backup_obj->password = $host[$_SERVER['HTTP_HOST']]['db_pass'];	$backup_obj->database = $host[$_SERVER['HTTP_HOST']]['db_name'];		if (!$backup_obj->_Connect())	{	$sukses=false;	$msg_status=alert(_ERROR,'Gagal konek');	}	mysqli_autocommit($backup_obj->link_id,false);		$r_id=$_POST['id_schedule'];	if(count($r_id)>0){		$id_selected=join(",",$r_id);	}else{		msg_warning("Pilih hasil ujian yang ingin di download","error");		header("location:".backendurl("$modul/view"));		exit();	}	$backup_obj->queries['quiz_schedule']="select * from quiz_schedule WHERE id in ($id_selected)";	$backup_obj->queries['quiz_done']="select * from quiz_done WHERE schedule_id in ($id_selected) AND is_done=1";	$backup_obj->comments = false;				//Directory on the server where the backup file will be placed. Used only if task parameter equals MSB_SAVE.		$backup_obj->backup_dir = $config['userdir'].'backend/modul/quiz_schedule/backup';					//Default file name format.		$backup_obj->fname_format = 'd_m_Y';	//--------------------- END - OPTIONAL PREFERENCE VARIABLES ---------------------		//Use GZip compression 		$backup_obj->use_gzip = true;		$backup_obj->stand_in_view = false;			//--------------------- END - REQUIRED EXECUTE VARIABLES ----------------------	  $filename="HASIL_UJIAN_QUIZROOM_".date("Ymd-His");	  $backup_obj->nama_simpan =$filename;	  $backup_obj->Execute($filename);	  $backup_obj->Download();	}if($action=="upload"){		$fname=$_FILES['filename']['tmp_name'];		$oname=$_FILES['filename']['name'];				include_once ("mysql_backup.php");		//----------------------- EDIT - REQUIRED SETUP VARIABLES -----------------------		$backup_obj = new MySQL_Backup();		$backup_obj->server = $host[$_SERVER['HTTP_HOST']]['db_host'];		$backup_obj->username = $host[$_SERVER['HTTP_HOST']]['db_user'];		$backup_obj->password = $host[$_SERVER['HTTP_HOST']]['db_pass'];		$backup_obj->database = $host[$_SERVER['HTTP_HOST']]['db_name'];		//------------------------ END - REQUIRED SETUP VARIABLES -----------------------		$backup_obj->Restore($fname);		$sukses=$backup_obj->status_commit;				if($sukses)		{				unlink($fname);			msg_warning("Hasil ujian berhasil diupload","success");			header("location:".backendurl("$modul/view"));			exit();		}		else		{			msg_warning($backup_obj->message,"error");			header("location:".backendurl("$modul/view"));			exit();		}		}if($action=="del"){$sql="DELETE FROM quiz_schedule WHERE id=$id";$r=$mysql->query($sql);	$sql="DELETE FROM quiz_done WHERE schedule_id=$id";$r=$mysql->query($sql);if($r){	header("location:".backendurl("$modul/view"));}}if($action=="del_participant"){$sql="DELETE FROM quiz_done WHERE id=$id";$r=$mysql->query($sql);	if($r){	header("location:".backendurl("$modul/view"));}}if($action=="download_excel"){error_reporting(E_ALL);ini_set('display_errors', FALSE);ini_set('display_startup_errors', FALSE);date_default_timezone_set('Asia/Jakarta');if (PHP_SAPI == 'cli')	die('This example should only be run from a Web Browser');// Create new PHPExcel object$objPHPExcel = new PHPExcel();// Set document properties$objPHPExcel->getProperties()->setCreator("websuka.com")							 ->setLastModifiedBy("websuka.com")							 ->setTitle("Ujian Online Berbasis Komputer")							 ->setSubject("Ujian Online Berbasis Komputer")							 ->setDescription("Ujian Online Berbasis Komputer")							 ->setKeywords("Ujian Online Berbasis Komputer")							 ->setCategory("Ujian Online Berbasis KOmputer");//AMBIL KUNCI JAWABAN	$quiz_id=$mysql->get1value("SELECT quiz_id FROM quiz_done WHERE schedule_id='".cleanInput($_GET['schedule_id'])."'");	$kunci=array();	$qkey=$mysql->query("SELECT id,answer FROM quiz_detail WHERE quiz_id=$quiz_id");	if($qkey and $mysql->numrows($qkey)>0){		while($d=$mysql->assoc($qkey)){			$kunci[$d['id']]=$d['answer'];		}	}$join_kunci=join("",$kunci);	//AMBIL KUNCI JAWABAN/////////////////////////////////////////$id=cleanInput($id);	$sql="SELECT * FROM quiz_done  WHERE is_done=1 AND schedule_id='".$_GET['schedule_id']."'";if($_GET['class']!="" AND $_GET['class']!="ALL"){	$sql.=" AND member_class='".$_GET['class']."'";}$sql.="  order by member_class,member_id";$r=$mysql->query($sql);// Add some data$objPHPExcel->setActiveSheetIndex(0)            ->setCellValue('A1',_UJIANMULAI)            ->setCellValue('B1',_KODELOGIN)            ->setCellValue('C1',_NAMALENGKAP)            ->setCellValue('D1',_CLASS)            ->setCellValue('E1',_KODESOAL)            ->setCellValue('F1',_NAMASOAL)            ->setCellValue('G1',_B)            ->setCellValue('H1',_S)            ->setCellValue('I1',_TIDAK_JAWAB)            ->setCellValue('J1',_SCORE)            ->setCellValue('K1',_KKM)            ->setCellValue('L1',_KET);$no=1;$quiz_date=$quiz_code=$quiz_title="";while($d=$mysql->assoc($r)){	$no++;	$answer=str_replace("{","=",$d['answer']);	$answer=str_replace("}","=",$answer);	$temp_answer=json_decode($d['answer'],true);		$r_answer=array();		if(count($kunci)>0){				$index=0;			foreach($kunci as $idsoal => $idsoal){				$index+=1;								//BANDINGKAN JAWABAN				if($temp_answer[$index]!="" and $temp_answer[$index]==$kunci[$idsoal]){					//BENAR					$r_answer[]="".$temp_answer[$index]."";				}elseif($temp_answer[$index]!="" and $temp_answer[$index]!=$kunci[$idsoal]){					//SALAH					$r_answer[]="".$temp_answer[$index]."";				}else{					//TAK JAWAB					$r_answer[]="".$temp_answer[$index]."";				}				//END BANDINGKAN JAWABAN			}					}//$json_answer=json_decode($d['answer'],true);	$json_answer=join("",$r_answer);		$ket=($d['score']>=$d['kkm']?_LULUS:_TIDAKLULUS);	$objPHPExcel->setActiveSheetIndex(0)            ->setCellValue('A'.$no,$d['start_time'])            ->setCellValue('B'.$no,$d['member_code'])            ->setCellValue('C'.$no,$d['member_fullname'])            ->setCellValue('D'.$no,$d['member_class'])            ->setCellValue('E'.$no,$d['quiz_code'])            ->setCellValue('F'.$no,$d['quiz_title_id'])            ->setCellValue('G'.$no,$d['benar'])            ->setCellValue('H'.$no,$d['salah'])            ->setCellValue('I'.$no,$d['tidak_jawab'])            ->setCellValue('J'.$no,$d['score'])            ->setCellValue('K'.$no,$d['kkm'])            ->setCellValue('L'.$no,$ket);}$q_schedule=$mysql->query("SELECT * FROM quiz_schedule WHERE id=".cleanInput($_GET['schedule_id']));	if($q_schedule and $mysql->numrows($q_schedule)>0){		while($d=$mysql->assoc($q_schedule)){			$quiz_info=json_decode($d['quiz_info'],true);			$quiz_date=date("Ymd",strtotime($d['tanggal']));			$quiz_code=$quiz_info['code'];			$quiz_title=$quiz_info['title_id'];			//$quiz_code=$d['quiz_code'];			//$quiz_title=$d['quiz_title_id'];			//$quiz_date=date("Ymd",strtotime($d['start_time']));		}	}//$filename="{$quiz_date}_{$quiz_code}_{$quiz_title}";$filename=$_GET['class']."_{$quiz_date}_{$quiz_code}_{$quiz_title}";$filename=cleanInput($filename,"field_name");$sheet_title="Nilai";$sheet_title=cleanInput($sheet_title,"field_name");// Rename worksheet$objPHPExcel->getActiveSheet()->setTitle($sheet_title);// Set active sheet index to the first sheet, so Excel opens this as the first sheet$objPHPExcel->setActiveSheetIndex(0);////////////////////////////////////////// Redirect output to a clientâ€™s web browser (Excel5)header('Content-Type: application/vnd.ms-excel');header('Content-Disposition: attachment;filename="'.$filename.'.xls"');header('Cache-Control: max-age=0');// If you're serving to IE 9, then the following may be neededheader('Cache-Control: max-age=1');// If you're serving to IE over SSL, then the following may be neededheader ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the pastheader ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modifiedheader ('Cache-Control: cache, must-revalidate'); // HTTP/1.1header ('Pragma: public'); // HTTP/1.0$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');$objWriter->save('php://output');exit;}?>