<?php$col_back="<input type=\"button\" class=\"btn back\" onclick=\" window.location.href='".backendurl("quiz_master")."';\" value=\"Back\">";if($action=="add" OR $action=="edit"){		$_SESSION['s_folder_soal']=$_GET['id_soal'];	$_SESSION['s_folder_guru']=$mysql->get1value("SELECT username FROM user WHERE id IN(SELECT created_by FROM quiz_master WHERE id='".$_GET['id_soal']."')");}if($action=="edit"){$r=$mysql->query("SELECT qd.*,p.pembahasan from $tabel qd LEFT JOIN quiz_pembahasan_pg p ON qd.id=p.quiz_detail_id where id=$id ");$d=$mysql->assoc($r);$form = new Form("update{$modul}");$form->configure(array(	"prevent" => array("bootstrap", "jQuery", "focus"),	"action" =>backendurl("$modul/update?id_soal=$id_soal&essay=".$_GET['essay']),	"enctype" =>"multipart/form-data" ));if($_GET['essay']!=1){$form->addElement(new Element_HTML('<legend>'._MODULEDIT.'</legend>'));}else{$form->addElement(new Element_HTML('<legend>'._MODULEDITESSAY.'</legend>'));}/*if(file_exists("$small_pic/".$d['thumbnail']) and $d['thumbnail']!=''){$thumbimage="$small_url/".$d['thumbnail'];$form->addElement(new Element_HTML('<div><img src="'.$thumbimage.'" /></div>'));} $form->addElement(new Element_File(_THUMBNAIL, "filename"));*/ $form->addElement(new Element_Hidden("form", "update{$modul}"));$form->addElement(new Element_Hidden("id", "$id"));$form->addElement(new Element_TinyMCE("<span class=\"labelTANYA\">"._PERTANYAAN."</span>","question", array("required" => 1,"value"=>$d['question'],"class"=>"smalltiny")));if($_GET['essay']==1){	//$form->addElement(new Element_Textbox("<span class=\"\">Kunci Jawaban</span>","answer", array("value"=>$d['answer'],"class"=>"")));	foreach($pilihan_kunci_essay as $pil_kunci_essay) {			$label_teks = str_replace("KUNCI","Kunci Jawaban ",$pil_kunci_essay);			$field = str_replace("KUNCI","answer",$pil_kunci_essay);			$form->addElement(new Element_Textbox("<span class=\"label$pil_kunci_essay\">$label_teks</span>","$pil_kunci_essay", array("value"=>$d[$field])));	}}if($_GET['essay']!=1){		foreach($pilihan_ganda as $pil_gan) {			$form->addElement(new Element_TinyMCE("<span class=\"label$pil_gan\">$pil_gan</span>","$pil_gan", array("value"=>$d[$pil_gan],"class"=>"smalltiny")));		}		/*		$form->addElement(new Element_TinyMCE("<span class=\"labelA\">"._A."</span>","A", array("value"=>$d['A'],"class"=>"smalltiny")));		$form->addElement(new Element_TinyMCE("<span class=\"labelB\">"._B."</span>","B", array("value"=>$d['B'],"class"=>"smalltiny")));		$form->addElement(new Element_TinyMCE("<span class=\"labelC\">"._C."</span>","C", array("value"=>$d['C'],"class"=>"smalltiny")));		$form->addElement(new Element_TinyMCE("<span class=\"labelD\">"._D."</span>","D", array("value"=>$d['D'],"class"=>"smalltiny")));		$form->addElement(new Element_TinyMCE("<span class=\"labelE\">"._E."</span>","E", array("value"=>$d['E'],"class"=>"smalltiny")));		*/		$select_model="		<select class='form-control' name='model' id='set_model'>		<option value=''>Pilih Model</option>		<option value='1' ".($d['model']=="1"?"selected='selected'":"").">Horizontal</option>		<option value='0' ".($d['model']=="0"?"selected='selected'":"").">Vertical</option>		</select>		";		$form->addElement(new Element_HTML('		<div class="control-group">		<label for="set_model" class="control-label">Pilih Model<span class="required">* </span></label>		<div class="controls">		'.$select_model.'		</div></div>'));		$option_pilihan_ganda = array_map(function($pil_gan) {			global $d;			ob_start();			echo "<option value='".$pil_gan."' ".($d['answer']=="$pil_gan"?"selected='selected'":"").">$pil_gan</option>";			return ob_get_clean();		},$pilihan_ganda);		$option_pilihan_ganda=join("",$option_pilihan_ganda);		$select_jawaban="		<select class='form-control' name='answer' id='set_jawaban'>		<option value=''>Pilih jawaban</option>		$option_pilihan_ganda		</select>		";		$form->addElement(new Element_HTML('		<div class="control-group">		<label for="set_jawaban" class="control-label">Kunci Jawaban<span class="required">* </span></label>		<div class="controls">		'.$select_jawaban.'		</div></div>'));		if($mode_pembahasan) {			$form->addElement(new Element_TinyMCE("<span class=\"labelPEMBAHASAN\">PEMBAHASAN</span>","pembahasan", array("required" => 0,"value"=>$d['pembahasan'],"class"=>"smalltiny")));		}}//$form->addElement(new Element_Textbox(_URL,"url", array("required" => 1,"value"=>$d['url'])));$form->addElement(new Element_Button(_SIMPAN));$form->addElement(new Element_Button(_BATAL, "button", array(	"onclick" => "history.go(-1);")));$form->render();}if($action=="add"){$col_back="<input type=\"button\" class=\"btn back\" onclick=\" window.location.href='".backendurl("quiz_detail/view/?id_soal=$id_soal")."';\" value=\"Back\">";	$form = new Form("{$modul}add");$form->configure(array(	"prevent" => array("bootstrap", "jQuery", "focus"),	"action" =>backendurl("$modul/save?id_soal=$id_soal&essay=".$_GET['essay']),	"enctype" =>"multipart/form-data" ));if($_GET['essay']!=1){	$form->addElement(new Element_HTML('<legend>'._MODULMASTERTAMBAH.'</legend>'));}else{
$form->addElement(new Element_HTML('<legend>'._MODULMASTERTAMBAHESSAY.'</legend>'));	
}$form->addElement(new Element_Hidden("form", "{$modul}add"));$form->addElement(new Element_TinyMCE("<span class=\"labelTANYA\">"._PERTANYAAN."</span>","question", array("required" => 1,"value"=>$d['question'],"class"=>"smalltiny")));if($_GET['essay']==1){		//$form->addElement(new Element_Textbox("<span class=\"\">Kunci Jawaban</span>","answer", array("value"=>$d['answer'],"class"=>"")));	foreach($pilihan_kunci_essay as $pil_kunci_essay) {			$label_teks = str_replace("KUNCI","Kunci Jawaban ",$pil_kunci_essay);			$field = str_replace("KUNCI","answer",$pil_kunci_essay);			$form->addElement(new Element_Textbox("<span class=\"label$pil_kunci_essay\">$label_teks</span>","$pil_kunci_essay", array("value"=>$d[$field])));	}}if($_GET['essay']!=1){	foreach($pilihan_ganda as $pil_gan) {		if(in_array($pil_gan,array('F','G','H','I','J'))) {			$d[$pil_gan]='-';		}		$form->addElement(new Element_TinyMCE("<span class=\"label$pil_gan\">$pil_gan</span>","$pil_gan", array("value"=>$d[$pil_gan],"class"=>"smalltiny")));	}	/*	$form->addElement(new Element_TinyMCE("<span class=\"labelA\">"._A."</span>","A", array("value"=>$d['A'],"class"=>"smalltiny")));$form->addElement(new Element_TinyMCE("<span class=\"labelB\">"._B."</span>","B", array("value"=>$d['B'],"class"=>"smalltiny")));$form->addElement(new Element_TinyMCE("<span class=\"labelC\">"._C."</span>","C", array("value"=>$d['C'],"class"=>"smalltiny")));$form->addElement(new Element_TinyMCE("<span class=\"labelD\">"._D."</span>","D", array("value"=>$d['D'],"class"=>"smalltiny")));$form->addElement(new Element_TinyMCE("<span class=\"labelE\">"._E."</span>","E", array("value"=>$d['E'],"class"=>"smalltiny")));*/$select_model="<select name='model' id='set_model'><option value=''>Pilih Model</option><option value='1'  selected='selected'>Horizontal</option><option value='0'>Vertical</option></select>";$form->addElement(new Element_HTML('<div class="control-group"><label for="set_model" class="control-label">Pilih Model<span class="required">* </span></label><div class="controls">'.$select_model.'</div></div>'));$option_pilihan_ganda = array_map(function($pil_gan) {	global $d;	ob_start();	echo "<option value='".$pil_gan."' ".($d['answer']=="$pil_gan"?"selected='selected'":"").">$pil_gan</option>";	return ob_get_clean();},$pilihan_ganda);$option_pilihan_ganda=join("",$option_pilihan_ganda);$select_jawaban="<select name='answer' id='set_jawaban' required='required'><option value=''>Pilih jawaban</option>$option_pilihan_ganda</select>";$form->addElement(new Element_HTML('<div class="control-group"><label for="set_jawaban" class="control-label">Kunci Jawaban<span class="required">* </span></label><div class="controls">'.$select_jawaban.'</div></div>'));if($mode_pembahasan) {	$form->addElement(new Element_TinyMCE("<span class=\"labelPEMBAHASAN\">PEMBAHASAN</span>","pembahasan", array("required" => 0,"value"=>$d['pembahasan'],"class"=>"smalltiny")));}}$form->addElement(new Element_Button(_SIMPAN));$form->addElement(new Element_Button(_BATAL, "button", array(	"onclick" => "history.go(-1);","class"=>"btn btn-default" )));ob_start();$form->render();$form_render=ob_get_clean();if($_GET['essay']!=1){$judul_form="Pilihan Ganda";}else{$judul_form="Essay";}echo <<<END<div class="card">		<div class="card-header">		  <h3 class="card-title">$judul_form</h3>		  		</div>		<!-- /.card-header -->		<!-- /.card-body -->		<div class="card-body">		$form_render		</div>		</div>END;}if($action=="" or $action=="search" or $action=="view"){//$form_search=form_search($keyword,"?id_soal=$id_soal");}if($action=="view" or $action=="" or $action=="search"){	//$col_tambah=button_add("$modul/add/?id_soal=$id_soal");$col_tambah.='<a href="'.backendurl("$modul/add/?id_soal=$id_soal").'" class="btn btn-primary"> (+) Pilihan Ganda</a>';$col_tambah.='&nbsp;&nbsp;&nbsp;<a href="'.backendurl("$modul/add/?id_soal=$id_soal&essay=1").'" class="btn btn-primary">(+) Essay</a>';$col_tambah.="&nbsp;&nbsp;&nbsp;<a class=\"btn btn-success\" href='".backendurl("quiz_upload_wordx/?id_soal=$id_soal")."'>(+) Template(Docx)</a>	  ";//$col_tambah.="<a class=\"printer\" target=\"_BLANK\"href='".backendurl("$modul/print/?id_soal=$id_soal&print=1")."'><img alt=\"Cetak\" border=\"0\" src=\"".backendurl("images/print.jpg")."\"></a>	  ";echo <<<END<div class="card">		<div class="card-header">		  <h3 class="card-title">$form_title</h3>		  <div class="float-right"></div>		</div>		<!-- /.card-header -->		<div class="card-body">		 <div class="row"><div class="col-md-12">$col_tambah</div></div>		</div>		<!-- /.card-body -->	  </div>END;//PILIHAN GANDAob_start();$sql="SELECT * FROM $modul  ";$sql.=" WHERE quiz_id='$id_soal' ";if($action=="search"){$sql.=" AND (question LIKE '%$keyword%' ";$sql_r=array();foreach($pilihan_ganda as $pil_gan) {	$sql_r[]=" $pil_gan LIKE '%$keyword%'";	} $sql.="OR ".join(" OR  ",$sql_r);$sql.=" ) ";}$r=$mysql->query($sql);echo "<table class=\"table\">";echo "<thead><tr><th style=\"width:10px\">No</th>";//<th>"._THUMBNAIL."</th>echo "<th>"._PERTANYAAN."</th>";echo "</tr></thead>";$no=($start+1);if($mysql->numrows($r)>0){echo '<tbody id="brand_row" class="ui-sortable">';while($d=$mysql->assoc($r)){$action_edit=btn_edit(backendurl("$modul/edit/".$d['id']."?id_soal=$id_soal"));$action_delete=btn_delete(backendurl("$modul/del/".$d['id']."?id_soal=$id_soal"));	echo "<tr><td valign=\"top\">$no</td>";/*$thumbnail_url="$small_url/".$d['thumbnail'];$thumbnail_path="$small_pic/".$d['thumbnail'];if(file_exists("$thumbnail_path")){echo "<th class='brand_thumbnail'><img src='".$thumbnail_url."'/></th>";}else{echo "<th>&nbsp;</th>";}*/echo "<td>".$d["question"]."<br/>";$option_pilihan="";foreach($pilihan_ganda as $pil_gan) {	if(strip_tags($d[$pil_gan])!="-"){		$option_pilihan.= "<li><span class='point_jawaban ".($d["answer"]=="$pil_gan"?"jawaban":"")."'>$pil_gan</span><span class='hasil_jawaban'>".$d["$pil_gan"]."</span></li>";	}}/*$option_pilihan="";if(strip_tags($d["A"])!="-"){$option_pilihan.= "<li><span class='point_jawaban ".($d["answer"]=="A"?"jawaban":"")."'>A</span><span class='hasil_jawaban'>".$d["A"]."</span></li>";}if(strip_tags($d["B"])!="-"){$option_pilihan.= "<li><span class='point_jawaban ".($d["answer"]=="B"?"jawaban":"")."'>B</span><span class='hasil_jawaban'>".$d["B"]."</span></li>";}if(strip_tags($d["C"])!="-"){$option_pilihan.= "<li><span class='point_jawaban ".($d["answer"]=="C"?"jawaban":"")."'>C</span><span class='hasil_jawaban'>".$d["C"]."</span></li>";}if(strip_tags($d["D"])!="-"){$option_pilihan.= "<li><span class='point_jawaban ".($d["answer"]=="D"?"jawaban":"")."'>D</span><span class='hasil_jawaban'>".$d["D"]."</span></li>";}if(strip_tags($d["E"])!="-"){$option_pilihan.= "<li><span class='point_jawaban ".($d["answer"]=="E"?"jawaban":"")."'>E</span><span class='hasil_jawaban'>".$d["E"]."</span></li>";}*/if($option_pilihan!=""){echo "Pilihan Jawaban<ul class='pilihan_jawaban'>";echo "$option_pilihan";echo "</ul>";}echo "<br/>";if($mode_pembahasan) {echo "<br/>";echo "<b>Pembahasan:</b><br/>";echo $mysql->get1value("SELECT pembahasan FROM quiz_pembahasan_pg WHERE quiz_detail_id=".$d['id']);echo "<br/>";echo "<br/>";}echo '<div class="btn-group btn-group-sm">'.$action_edit.$action_delete.'</div>';echo "<br/>";echo "<br/>";echo "<br/>";echo "</td>";/*echo "<th>".$d["A"]."</th>";echo "<th>".$d["B"]."</th>";echo "<th>".$d["C"]."</th>";echo "<th>".$d["D"]."</th>";echo "<th>".$d["E"]."</th>";echo "<th>".$d["answer"]."</th>";* */	echo "</tr>";$no++;}echo "</tbody>";}echo "</table>";$pilihan_ganda_content = ob_get_clean();/////////////////////////////////////////////////PILIHAN GANDAecho <<<END<div class="card">		<div class="card-header">		  <h3 class="card-title">Pilihan Ganda</h3>		  <div class="card-tools">			  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>			  </button>			</div>		</div>		<!-- /.card-header -->		<!-- /.card-body -->		<div class="card-body">			$pilihan_ganda_content		</div>		</div>END;////////////////////END PILIHAN GANDAob_start();////////SOAL ESSAY$sql="SELECT * FROM quiz_essay  ";$sql.=" WHERE quiz_id='$id_soal' ";if($action=="search"){$sql.=" AND (question LIKE '%$keyword%'  ";/*OR A LIKE '%$keyword%' OR B LIKE '%$keyword%' OR C LIKE '%$keyword%' OR D LIKE '%$keyword%' OR E LIKE '%$keyword%' */$sql_r=array();foreach($pilihan_kunci_essay as $pil_kunci_essay) {	$field=str_replace("KUNCI","answer",$pil_kunci_essay);	$sql_r[]=" $field LIKE '%$keyword%' ";}$sql.=" OR ".join(" OR ",$sql_r);$sql.=")";}$r=$mysql->query($sql);$total_records = $mysql->numrows($r);$start = $screen * $max_page_list;$pages = ceil($total_records/$max_page_list);if ($pages>1) $col_pagination=pagination($screen,"?id_soal=$id_soal");$sql.="  order by $sort_by $sort_order  LIMIT $start, $max_page_list";$r=$mysql->query($sql);echo "<table class=\"table\">";echo "<thead><tr><th  style=\"width:25px;\">No</th>";//<th>"._THUMBNAIL."</th>echo "<th>"._PERTANYAAN."</th>";echo "</tr></thead>";$no=($start+1);if($mysql->numrows($r)>0){echo '<tbody id="brand_row" class="ui-sortable">';while($d=$mysql->assoc($r)){	echo "<tr id='list_{$d['id']}' class='rowmove'><td>$no</td>";/*$thumbnail_url="$small_url/".$d['thumbnail'];$thumbnail_path="$small_pic/".$d['thumbnail'];if(file_exists("$thumbnail_path")){echo "<th class='brand_thumbnail'><img src='".$thumbnail_url."'/></th>";}else{echo "<th>&nbsp;</th>";}*/echo "<td>".$d["question"];foreach($pilihan_kunci_essay as $pil_kunci_essay) {	$field=str_replace("KUNCI","answer",$pil_kunci_essay);	echo "<div class=\"kunci_essay\">".$d[$field]."</div>";}$action_edit=btn_edit(backendurl("$modul/edit/".$d['id']."?id_soal=$id_soal&essay=1"));$action_delete=btn_delete(backendurl("$modul/del/".$d['id']."?id_soal=$id_soal&essay=1"));	echo "<br/><br/>";echo '<div class="btn-group btn-group-sm">'.$action_edit.$action_delete.'</div>';echo "<br/><br/>";echo "</td>";//$ar_action=array("edit"=>$d['id']."?id_soal=$id_soal&essay=1","del"=>$d['id']."?id_soal=$id_soal&essay=1");echo "</tr>";$no++;}echo "</tbody>";}echo "</table>";$essay_content=ob_get_clean();;/////////////////////////////////////////////////echo <<<END<div class="card">		<div class="card-header">		  <h3 class="card-title">Soal Essay</h3>		  <div class="card-tools">			  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>			  </button>			</div>		</div>		<!-- /.card-header -->		<div class="card-body">			$essay_content		</div>		<!-- /.card-body -->	  </div>END;///////////////////}if($action=="print"){	$sql="SELECT * FROM quiz_master  ";$sql.=" WHERE id='$id_soal' ";list($soal)=$mysql->query_data($sql);$sql="SELECT * FROM $modul  ";$sql.=" WHERE quiz_id='$id_soal' ";if($action=="search"){$sql.=" AND (question LIKE '%$keyword%' OR A LIKE '%$keyword%' OR B LIKE '%$keyword%' OR C LIKE '%$keyword%' OR D LIKE '%$keyword%' OR E LIKE '%$keyword%' ) ";}$r=$mysql->query($sql);$total_records = $mysql->numrows($r);$start = $screen * $max_page_list;$pages = ceil($total_records/$max_page_list);if ($pages>1) $col_pagination=pagination($screen,"?id_soal=$id_soal");$sql.="  order by $sort_by $sort_order  LIMIT $start, $max_page_list";$r=$mysql->query($sql);ob_start();echo "<div><table class='table table-hover table-nomargin table-bordered '  cellspacing=0 cellpadding=5><tr><td>Kode</td><td>:</td><td>".$soal['code']."</td></tr><tr><td>Judul</td><td>:</td><td>".$soal['title_id']."</td></tr><tr><td>KKM</td><td>:</td><td>".$soal['kkm']."</td></tr><tr><td>Durasi</td><td>:</td><td>".$soal['duration']." Menit</td></tr></table></div><br><br><br>";echo "<table id='printsoal' border=0 class='view-table table table-hover table-nomargin  '>";$no=($start+1);if($mysql->numrows($r)>0){echo '<tbody id="brand_row" class="ui-sortable">';while($d=$mysql->assoc($r)){	echo "<tr id='list_{$d['id']}' class='rowmove'><td>$no</td>";/*$thumbnail_url="$small_url/".$d['thumbnail'];$thumbnail_path="$small_pic/".$d['thumbnail'];if(file_exists("$thumbnail_path")){echo "<th class='brand_thumbnail'><img src='".$thumbnail_url."'/></th>";}else{echo "<th>&nbsp;</th>";}*/echo "<td>".$d["question"]."<br/>Pilihan Jawaban<ul class='pilihan_jawaban'>";if(strip_tags($d["A"])!="-"){echo "<li><span class='point_jawaban ".($d["answer"]=="A"?"jawaban":"")."'>A</span><span class='hasil_jawaban'>".$d["A"]."</span></li>";}if(strip_tags($d["B"])!="-"){echo "<li><span class='point_jawaban ".($d["answer"]=="B"?"jawaban":"")."'>B</span><span class='hasil_jawaban'>".$d["B"]."</span></li>";}if(strip_tags($d["C"])!="-"){echo "<li><span class='point_jawaban ".($d["answer"]=="C"?"jawaban":"")."'>C</span><span class='hasil_jawaban'>".$d["C"]."</span></li>";}if(strip_tags($d["D"])!="-"){echo "<li><span class='point_jawaban ".($d["answer"]=="D"?"jawaban":"")."'>D</span><span class='hasil_jawaban'>".$d["D"]."</span></li>";}if(strip_tags($d["E"])!="-"){echo "<li><span class='point_jawaban ".($d["answer"]=="E"?"jawaban":"")."'>E</span><span class='hasil_jawaban'>".$d["E"]."</span></li>";}	echo "</ul></td>";echo "</tr>";$no++;}echo "</tbody>";}echo "</table>";$html=ob_get_clean();echo $html;/*VsWord::autoLoad();	$doc = new VsWord();  $parser = new HtmlParser($doc);  $parser->parse($html);    echo '<pre>'.($doc->getDocument()->getBody()->look()).'</pre>';$doc->saveAs('tinymce.docx'); exit();*/ }?>