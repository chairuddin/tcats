<?phpif($action=="edit" and $id!=""){//$btn_tambah=button_add("$modul/add?category_id=$category_id");$q=$mysql->query("SELECT * FROM app_order WHERE id=$id ");$d=$mysql->fetch_assoc($q);list($member)=$mysql->query_data("SELECT fullname,email FROM quiz_member WHERE id=".$d['member_id']);$fullname=$member['fullname'];$email=$member['email'];$whatsapp='';$produk=$d['title'];$total=currency($d['total'],"Rp");$tanggal_order=tgl_indo_long(date("Y-m-d",strtotime($d['created_date'])))." Pukul ".date("H:i:s ",strtotime($d['created_date']));$link_approve=backendurl("app_order/approve_payment/$id");echo <<<END<div class="card card-navy">		<div class="card-header">		  <h3 class="card-title">Pembayaran</h3>		  		</div>		<!-- /.card-header -->		<div class="card-body">			<table>			    <tr><td>Tanggal</td><td>:</td><td>$tanggal_order</td></tr>			    <tr><td>Nama</td><td>:</td><td>$fullname</td></tr>			    <tr><td>Email</td><td>:</td><td>$email</td></tr>			    <tr><td>Whatsapp</td><td>:</td><td>$whatsapp</td></tr>			    <tr><td>Produk</td><td>:</td><td>$produk</td></tr>			    <tr><td>Total</td><td>:</td><td>$total</td></tr>			</table>		    			<a href="$link_approve" class="btn btn-success mt-5 mr-3">Lunas</a>			<a href="#" onclick="window.history.back();" class="btn btn-default mt-5">Kembali</a>		</div>		<!-- /.card-body -->	  </div></div>END;}if($action=="unpaid" or $action=="paid"){//$btn_tambah=button_add("$modul/add?category_id=$category_id");$unpaid_url=backendurl('app_order/unpaid');$paid_url=backendurl('app_order/paid');$class_unpaid=$action=='unpaid'?'btn-success':'btn-default';$class_paid=$action=='paid'?'btn-success':'btn-default';echo <<<END<div class="card card-navy">		<div class="card-header">		  <h3 class="card-title">$course_title</h3>		  <div class="float-right">$btn_tambah</div>		</div>		<!-- /.card-header -->		<div class="card-body">		        <a href="$unpaid_url" class="btn $class_unpaid" >Belum Bayar</a>&nbsp;<a href="$paid_url" class="btn $class_paid">Lunas</a><br/><br/>				<table id="datalist" class="table table-bordered table-striped responsive no-wrap">				<thead>				<tr>				<th style="width:40px;">No</th>                <th>Waktu</th>                <th>Member</th>                <th>Product</th>				<th>Category</th>				<th>Status</th>                <th>Total</th>                <th>Expired</th>                <th>Action</th>				<!-- <th style="width:80px;">Action</th> -->				</tr>				</thead>				</table>		</div>		<!-- /.card-body -->	  </div></div>END;$url_data=backendurl("$modul/data?category_id=$category_id&is_paid=$action");$script_js.=<<<END<script>$(document).ready(function(){	  	// datatables		$('#datalist').DataTable({					'searching'   : true,			'ordering'    : true,			'info'        : true,			'responsive'  : true,			'processing'  : true,			'serverSide'  : true,			"ajax": {				"url": '$url_data',				"type": "POST"						 },			 "order": [				[ 0, "desc" ]			],								});			});	</script>END;}if($action=="data") {		$category_id=$_GET['category_id'];		$column_order = array('a.id','a.title','c.title');	$column_search = array('a.title','c.title','m.fullname','m.email','m.wa');	$order = array('a.id' => 'DESC');	$is_paid=$_GET['is_paid']=='unpaid'?'0':'1';	if(isset($_POST['order'])) { // here order processing		$order_by = " ORDER BY {$column_order[$_POST['order']['0']['column']]} {$_POST['order']['0']['dir']}";	} else {		$order = $order;				$order_by = " ORDER BY id DESC ";	}	if ($_POST['length'] != -1 AND $_POST['length']!="") {		$where_limit = "LIMIT {$_POST['start']}, {$_POST['length']}";	}	$i = 0;	$sql_search=array();	foreach ($column_search as $item) { // loop column 				if($_POST['search']['value']) { // if datatable send POST for search						$sql_search[]= " $item LIKE '%{$_POST['search']['value']}%' ";		}		$i++;	}		if(count($sql_search)>0){	$sql_r[]=" ".join(" OR ",$sql_search)." ";	}		$sql=" 	SELECT 		a.id,		a.title,        a.created_date,		a.total,		a.category_id,		c.title category,		a.is_paid,        a.time_limit,        m.fullname,m.email	FROM 		app_order a	LEFT JOIN app_category c ON c.id=category_id    LEFT JOIN quiz_member m ON m.id=a.member_id		";		$sql.=" WHERE 1=1 AND a.is_paid='$is_paid' ";	if(count($sql_r)>0){		$sql.=" AND  (".join(" OR ",$sql_r).") ";	}		$result_total = $mysql->query($sql);	$total=$mysql->num_rows($result_total);	$sql .= " $order_by $where_limit";		$result = $mysql->query($sql);		$data = array();		$gotopage = $_POST['start']/$_POST['length'];	$no = $_POST['start'];	while($d = $mysql->fetch_assoc($result)) {		$no++;		$row = array();				$row[]=$no;        $row[]=$d['created_date'];        $row[]=$d['fullname'];        $row[]=$d['title'];		$row[]=$d['category'];        $row[]=$d['is_paid']==0?'<span  class="badge badge-danger">Belum bayar</span>':'<span class="badge badge-success">Lunas</span>';		$row[]=currency($d['total']);        $row[]=$d['time_limit']==0?'Unlimited':$d['time_limit'].' Bulan';		        		$action_edit='<a class="btn btn-success" href="'.backendurl("$modul/edit/".$d['id']).'"><i class="fas fa-check" aria-hidden="true"></i></a>';		$action_delete='<a class="btn btn-danger"  title="Hapus order"				data-toggle="modal" 				data-target="#modal-default" 				data-title="Hapus data" 				data-body="Apakah anda yakin ingin menghapus data ini?"				data-btn2=""				data-btn2name=""				data-btn1="'.backendurl("$modul/del/".$d['id']).'"				data-btn1name="Hapus"				>				<i class="fas fa-trash"></i>		</a>';				$row[]='<div class="btn-group">'.$action_info.$action_edit.$action_delete.'</div>';				$data[] = $row;	}			$output = array(		"draw" => $_POST['draw'],		"recordsTotal" => $total,		"recordsFiltered" => $total,		"data" => $data	);	die(json_encode($output));}?>