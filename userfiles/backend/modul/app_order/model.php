<?php/*Catatan pakai yona-validation:Form :	Form menggunakan class yona-validation	Tombol submit name=submitVar  : nama element harus sama dengan var   * */$hari_ini=date("Y-m-d H:i:s");$admin_id=$_SESSION['s_id'];		/*$validation->set_validation(array('var'=>'price','label'=>'Harga'))->required();$validation->set_validation(array('var'=>'category_id','label'=>'Category'))->required();$validation->set_validation(array('var'=>'title','label'=>'Judul'))->minlength(3)->required();$validation->set_validation(array('var'=>'content','label'=>'Isi Course'))->required();$validation->generate_js_validation();if($action=="save" or $action=="update") {	$id=$_POST['id'];	$_POST['price']=cleanInput($_POST['price'],'money');	$_POST['discount']=cleanInput($_POST['discount'],'money');	if($validation->valid()){		$r_post=array(		'title',        'subtitle',		'content',		'category_id',		'price',		'discount',        'time_limit'		);				$sql_r = array();				if($action=="save") {			$sql_r[]="created_by='$admin_id'";			$sql_r[]="created_date='$hari_ini'";		}				if($action=="update") {			$sql_r[]="modified_by='$admin_id'";			$sql_r[]="modified_date='$hari_ini'";		}						foreach($r_post as $i => $v) {			if($v!='content') {				$post=cleanInput($_POST[$v]);			} else {				$post=$_POST[$v];			}			$sql_r[]="$v = '".addslashes($post)."'";		}				if($action=="save") {			$sql=" INSERT INTO app_product SET ".join(" ,",$sql_r);			$q=$mysql->query($sql);			$last_id=$mysql->insert_id();			$id=$last_id;		}				if($action=="update") {			$sql=" UPDATE app_product SET ".join(" ,",$sql_r)." WHERE id=$id ";			$q=$mysql->query($sql);		}				$category_id=$mysql->get1value("SELECT category_id FROM app_product WHERE id=$id ");				} else {       		sweetalert2($type="warning",$msg=($action=="update"?"Update":"Tambah")." Course gagal, data tidak valid",backendurl("$modul".($action=="update"?"/edit/$id":"/add"))."?category_id=$category_id");	}		if($q){		sweetalert2($type="success",$msg=($action=="update"?"Update":"Tambah")." Course berhasil",backendurl("$modul")."?category_id=$category_id");	} else {		sweetalert2($type="warning",$msg=($action=="update"?"Update":"Tambah")." Course gagal. ",backendurl("$modul".($action=="update"?"/edit/$id":"/add"))."?category_id=$category_id");	}	}*/if($action=="del"){	$id=cleanInput($id,'numeric');	$valid=true;	$mysql->autocommit(false);			$sql="DELETE FROM app_order WHERE id='$id'";	$r=$mysql->query($sql);	if($r and $valid){		$mysql->commit();		$mysql->autocommit(true);		sweetalert2($type="success",$msg="Hapus order berhasil",backendurl("$modul"));	} else {		$mysql->rollback();			sweetalert2($type="warning",$msg="Hapus order gagal",backendurl("$modul"));	}	}if($action=="approve_payment") {    $q=$mysql->query("SELECT * FROM app_order WHERE id=$id ");    $d=$mysql->fetch_assoc($q);    $now=date("Y-m-d H:i:s");    $time_limit=$d['time_limit'];    $currentDate = new DateTime(date("Y-m-d"));    // Add 3 months to the current date    $currentDate->modify('+'.$time_limit.' months');        // Store the new date in a variable    $expired_date = $currentDate->format('Y-m-d');        $expired_date=    $approve_payment_query=$mysql->query("UPDATE app_order SET is_paid=1,payment_date='$now',expired_date='$expired_date' WHERE id=$id ");    if($approve_payment_query) {        sweetalert2($type="success",$msg="Update pembayaran berhasil",backendurl("$modul"));    } else{        sweetalert2($type="warning",$msg="Update pembayaran gagal",backendurl("$modul"));    }}