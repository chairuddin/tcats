<?php$kondisi="";if(($_SESSION['s_level']==0 and $id_soal!="") or ($_SESSION['s_level']==0 and $id!="")){	$kondisi=" AND created_by='".$_SESSION['s_id']."'";	$r=$mysql->query("SELECT * from quiz_master where id=".($id_soal==""?$id:$id_soal)." $kondisi");	if($r and $mysql->numrows($r)==0){	msg_warning("Anda tidak berhak mengakses soal tersebut","error");	header("location:".backendurl("quiz_master/view/"));	exit();		}}	if($action=="save"){	if(Form::isValid("{$modul}add",false) and $_POST['form']=="{$modul}add") 	{	${"A"}=addslashes($_POST["A"]);	${"B"}=addslashes($_POST["B"]);	${"C"}=addslashes($_POST["C"]);	${"D"}=addslashes($_POST["D"]);	${"E"}=addslashes($_POST["E"]);	${"answer"}=addslashes($_POST["answer"]);	${"question"}=addslashes($_POST["question"]);	${"model"}=addslashes($_POST["model"]);	${"id_soal"}=cleanInput($_GET["id_soal"]);		if($_GET['essay']==1){
		$tabel="quiz_essay";
	}		$sql_r=array();	$sql="	INSERT INTO $tabel SET ";		$sql_r[]="question='".${"question"}."'";		$sql_r[]="A='".${"A"}."'";		$sql_r[]="B='".${"B"}."'";		$sql_r[]="C='".${"C"}."'";		$sql_r[]="D='".${"D"}."'";		$sql_r[]="E='".${"E"}."'";		$sql_r[]="answer='".${"answer"}."'";		$sql_r[]="model='".${"model"}."'";		$sql_r[]="quiz_id='".${"id_soal"}."'";		$sql.=join(",",$sql_r);		$r=$mysql->query($sql);	if($r)	{			$id_master=$id_soal;	generate_soal_json($id_master);		$id_terakhir=$mysql->get1value("SELECT id FROM quiz_detail ORDER BY id DESC limit 1 ");		msg_warning(_BERHASILTAMBAH,"success");		Form::clearValues("{$modul}add"); 	header("location:".backendurl("$modul/view?id_soal=$id_soal#list_$id_terakhir"));	exit();	}	else	{	msg_warning(_GAGALADD,"error");	header("location:".backendurl("$modul/add?id_soal=$id_soal"));	exit();	}}	}if($action=="update"){	$id=cleanInput($_POST['id'],'numeric');		${"A"}=addslashes($_POST["A"]);	${"B"}=addslashes($_POST["B"]);	${"C"}=addslashes($_POST["C"]);	${"D"}=addslashes($_POST["D"]);	${"E"}=addslashes($_POST["E"]);	${"answer"}=addslashes($_POST["answer"]);	${"model"}=addslashes($_POST["model"]);	${"question"}=addslashes($_POST["question"]);			if(!Form::isValid("update{$modul}",false) or $_POST['form']!="update{$modul}") 	{		redirecto(_GAGALUPDATE,"error","edit/$id");	}	$sql_r=array();	$sql="	UPDATE $tabel SET ";		$sql_r[]="question='".${"question"}."'";		$sql_r[]="A='".${"A"}."'";		$sql_r[]="B='".${"B"}."'";		$sql_r[]="C='".${"C"}."'";		$sql_r[]="D='".${"D"}."'";		$sql_r[]="E='".${"E"}."'";		$sql_r[]="answer='".${"answer"}."'";		$sql_r[]="model='".${"model"}."'";		$sql.=join(",",$sql_r);	$sql.="	WHERE id=$id";		$r=$mysql->query($sql);	if($r)	{	$id_master=$mysql->get1value("SELECT quiz_id FROM $tabel WHERE id='$id' ");	generate_soal_json($id_master);	Form::clearValues("update{$modul}"); 	msg_warning(_BERHASILUPDATE,"success");	header("location:".backendurl("$modul/view?id_soal=$id_soal#list_$id"));	exit();	}	else	{	msg_warning(_GAGALUPDATE,"error");	header("location:".backendurl("$modul/edit/$id?id_soal=$id_soal"));	exit();	}	}if($action=="del"){	if($_GET['essay']==1){	$tabel="quiz_essay";}$id=cleanInput($id,'numeric');$id_master=$mysql->get1value("SELECT quiz_id FROM $tabel WHERE id='$id' ");$sql="DELETE FROM $tabel WHERE id='$id'";$r=$mysql->query($sql);if($r){	generate_soal_json($id_master);	Form::clearValues("update{$modul}");	msg_warning(_BERHASILHAPUS,"success");	header("location:".backendurl("$modul/view?id_soal=".$_GET['id_soal']));	exit();}else{	msg_warning(_GAGALHAPUS,"error");	header("location:".backendurl("$modul/view?id_soal=".$_GET['id_soal']));	exit();}}if($action=="sortitem"){$list=$_POST['list'];for($i=1;$i<=count($list);$i++){$idlist=cleanInput($list[$i-1],'numeric');$q=$mysql->query("UPDATE $tabel set urutan=$i WHERE id='$idlist'");}exit();}?>	