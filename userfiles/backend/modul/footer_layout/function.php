<?phpfunction catstructure($sql){global $cats,$mysql,$modul,$lang;$cats = new categories();$mycats = array();$result = $mysql->query($sql);while ($row = $mysql->assoc($result)) {$mycats[] = array('id' => $row['id'],'block' => $row['block'],'id_menu' => $row['id_menu'], 'nama' => $row['name_id'], 'parent' => $row['parent'], 'level' => 0);}$cats->get_cats($mycats);ob_start();echo "<ol class=\"sortable ui-sortable\"class=\"sortable ui-sortable\">"; for ($i = 0; $i < count($cats->cats); $i++)  {	if($cats->cats[$i]['parent']==0)	{		$cat_id=$cats->cats[$i]['id'];		$id_menu=$cats->cats[$i]['id_menu'];		echo "<li id='list_$cat_id' data-catid='$id_menu'>";		echo "<div class=\"kat_item ui-state-default ui-draggable\"><i title='up or down only' class='glyphicon-move'></i><div class=\"kat_nama\"><a href=\"#\" data-pk=\"".$cats->cats[$i]['id']."\"  data-name=\"name_$lang\" class=\"title-cat\">".$cats->cats[$i]['nama']."</a></div>";           echo "<div class=\"kat_action\">           <a href=\"".backendurl("block_".$cats->cats[$i]['block']."/edit/".$cat_id)."\"><i class='icon-cogs'></i></a>           <a class=\"footer_layout_action-remove\" href=\"" .backendurl("$modul/del/").$cats->cats[$i]['id_menu']."/".$cats->cats[$i]['id']."\"><i class='glyphicon-remove'></i></a>			</div></div>";		child($cats->cats[$i]['id']);		echo "</li>";	} }echo "</ol>";return ob_get_clean();}function child($id){global $cats,$modul;	echo "<ol>";	for ($i = 0; $i < count($cats->cats); $i++)  	{		if($cats->cats[$i]['parent']==$id)		{		$cat_id=$cats->cats[$i]['id'];		$id_menu=$cats->cats[$i]['id_menu'];		echo "<li id='list_$cat_id' data-catid='$id_menu'>";		echo "<div class=\"kat_item ui-state-default ui-draggable\"><i title='up or down only' class='glyphicon-move'></i><div class=\"kat_nama\">".$cats->cats[$i]['nama'] ."</div> ";           echo "<div class=\"kat_action\"><a href=\"".backendurl("$modul/edit/").$cats->cats[$i]['id']."\"><i class='glyphicon-edit'></i></a> <a href=\"" .backendurl("$modul/del/").$cats->cats[$i]['id'] . "\"><i class='glyphicon-remove'></i></a>			</div></div>";		child($cats->cats[$i]['id']);		echo "</li>";		}			}	echo "</ol>";}function urutkan($tabel, $urutan, $kondisi = "", $id = "", $kondisiprev = "") {global $mysql;    $urutansebelumnya = "";    $kondisi = trim($kondisi);    $kondisiprev = trim($kondisiprev);    if (strlen($id) > 0) {        $sqlurut = "SELECT urutan FROM $tabel WHERE id='" . $id . "'";        $resulturut = $mysql->query($sqlurut);        list($urutansebelumnya) = $mysql->row($resulturut);        $mx = getMaxNumber($tabel, 'urutan') + 5;        $sql = "UPDATE $tabel SET urutan='$mx' WHERE id='" . $id . "'";        $result = $mysql->query($sql);    }    $sql = "UPDATE $tabel SET urutan=urutan+1 WHERE ";    $sql .= "urutan>='" . $urutan . "' ";    $sql .= ( (strlen($kondisi) > 0) ? "AND $kondisi" : "");    $result = $mysql->query($sql);    if (strlen($urutansebelumnya) > 0 and $kondisi == $kondisiprev) {        $sql = "UPDATE $tabel SET urutan=urutan-1 WHERE urutan>='" . ($urutansebelumnya + 1) . "' " . ((strlen($kondisi) > 0) ? "AND $kondisi" : "");        $result = $mysql->query($sql);    }    $sql = "select * FROM $tabel " . ((strlen($kondisi) > 0) ? "WHERE $kondisi" : "");    $total = $mysql->numrows($mysql->query($sql));    //echo $sql;    if (strlen($urutansebelumnya) > 0 and $kondisi == $kondisiprev and $urutansebelumnya < $urutan) {        if ($urutan > ($total + 1)) {            $urutan = $total;        }        $sql = "UPDATE $tabel SET urutan='" . ($urutan - 1) . "' WHERE id='" . $id . "'";    } else {        if ($urutan > $total) {            $urutan = $total;        }        $sql = "UPDATE $tabel SET urutan='" . $urutan . "' WHERE id='" . $id . "'";    }        $result = $mysql->query($sql);    return $result;}function getMaxNumber($tabel, $kolom, $kondisi = "") {global $mysql;$max=1;    $sql = "SELECT max($kolom) FROM $tabel ";    if (strlen($kondisi) > 0) {        $sql .= "WHERE $kondisi ";    }        $result = $mysql->query($sql);    if($result and $mysql->numrows($result)>0)    {    list($max) = $mysql->row($result);	}    return $max;}?>