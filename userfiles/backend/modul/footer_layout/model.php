<?phpif($action=="save_block"){		if($_POST['submit']!="")		{				$id=cleanInput($_POST['id']);				$urutan = $mysql->get1value("SELECT max(urutan) FROM footer_block_layout")+1;				$auto_increment=$mysql->last_auto_increment("footer_block_layout");				$sql="INSERT INTO footer_block_layout (id,urutan)VALUES('$auto_increment','$urutan')";				$q=$mysql->query($sql);								if($q){				redirecto(_BERHASILTAMBAHBLOK,"success","edit/$id");				}				else				{				redirecto(_GAGALTAMBAH,"error","edit/$id");					}						}}if($action=="save_css"){		//SINGLE IMAGE	$r_filename=array('thumbnail');	foreach($r_filename as $filename)	{	$banner_thumb_width=${"thumb_width_$filename"};		$banner_large_width=${"large_width_$filename"};		${"modified$filename"}="";	if (count($_FILES[$filename])>0 AND $_FILES[$filename]['error'] != UPLOAD_ERR_NO_FILE)	{	   $hasilupload = upload($filename, $large_pic,"", $maxfilesize); 	   if($hasilupload!="")	   {		msg_warning(_GAGALADDIMAGE." ".$hasilupload,"error");		header("location:".backendurl("$modul/edit/$id"));		exit();	   }	   else	   {	      //ambil informasi basename dan extension            $temp = explode(".", $_FILES[$filename]['name']);            $extension = $temp[count($temp) - 1];            $basename = '';            for ($i = 0; $i < count($temp) - 1; $i++) {                $basename .= $temp[$i];            }		$unique_name=uniqid();			${"modified$filename"} = "$basename-$unique_name.$extension";				//create thumbnail		$hasilresize = resize("$large_pic/".$_FILES[$filename]['name'], "$small_pic/".${"modified$filename"}, 'l', $banner_thumb_width);		if ($hasilresize!="") {		msg_warning(_GAGALADDTHUMBNAIL." ".$hasilresize,"error");		header("location:".backendurl("$modul/edit/$id"));		exit();		}		//resize		 list($filewidth, $fileheight, $filetype, $fileattr) = getimagesize("$large_pic/" . $_FILES[$filename]['name']);		 		 if ($filewidth > $banner_large_width) {                //rename sambil resize gambar asli sesuai yang diizinkan                $hasilresize = resize("$large_pic/" . $_FILES[$filename]['name'], "$large_pic/".${"modified$filename"}, 'w', $banner_large_width);                if ($hasilresize !="") {					msg_warning(_GAGALRESIZE." ".$hasilresize,"error");					header("location:".backendurl("$modul/edit/$id"));					exit();                }				unlink("$large_pic/" . $_FILES[$filename]['name']);                            } else {                rename("$large_pic/" . $_FILES[$filename]['name'], "$large_pic/".${"modified$filename"});            }				$r=$mysql->query("SELECT $filename from footer_block_layout WHERE id='$id'");		list($oldfilename)=$mysql->row($r);			//del gambar asli			if($oldfilename!="")			{			if(file_exists("$large_pic/$oldfilename"))unlink("$large_pic/$oldfilename");			if(file_exists("$small_pic/$oldfilename"))unlink("$small_pic/$oldfilename");			}		  }		}	}			$id=$_POST['id'];	$isfull=$_POST['isfull'];	$nopadding=$_POST['nopadding'];	$n=array();	foreach($css as $i =>$v)	{		if($_POST[$v[0]]!="")		{		$n[]=$v[0].":".addslashes($_POST[$v[0]]);		}	}	$n_style="";	if(count($n)>0)	{		$n_style=join(";",$n);	}		$sql="UPDATE footer_block_layout SET style='$n_style',isfull='$isfull',nopadding='$nopadding' ";	if($modifiedthumbnail!="")$sql.=",thumbnail='".$modifiedthumbnail."'";	$sql.=" WHERE id=$id";	$q=$mysql->query($sql);		redirecto(_BERHASILUPDATECSS,"success","edit/$id_menu");}if($action=="update"){		$parent =cleanInput($_POST['parent'],'numeric');		$parent =$parent==""?0:$parent;		$rblock =json_decode($_POST['block'],true);		$column=$rblock['column'];		$name_id=$rblock['name'];		$type=$rblock['type'];		$block_page=$rblock['block_page'];		$id_block=cleanInput($_POST['id_block']);		$id=$_POST['id'];					if (!preg_match('/[0-9]*/',$urutan)) $urutan=1;		$mx = getMaxNumber($modul, 'urutan',"parent='".$parent."' ")+2;		//$newid = getMaxNumber($modul, 'id')+1;		$auto_increment=$mysql->last_auto_increment("footer_layout");		$sql = "INSERT INTO $modul 				(id,id_block,parent,name_id,block,urutan,type) values ( ";		$sql.= "'$auto_increment','$id_block','$parent','$name_id','$column','$mx','$type'";		$sql.= ")";				$result = $mysql->query($sql);		$r = urutkan($modul, $urutan, "parent='".$parent."' ", $newid, "parent='".$parent."' ");				/*		//Jika type=mod maka insert footer_layout_item secara otomatis		$q="		INSERT INTO footer_layout_item (id_layout,name_id,block,urutan,value,position)		values ('$auto_increment','$name_id','$block_page','1','',1)		";		$r_block=$mysql->query($q);		//end type mod 		*/ 		if($result and $r)		{		redirecto(_BERHASILTAMBAHKOLOM,"success","edit/$id");		}		else		{		$del=$mysql->query("DELETE FROM footer_layout WHERE id='$auto_increment'");			$del=$mysql->query("DELETE FROM footer_layout_item WHERE id='$auto_increment'");					redirecto(_GAGALTAMBAH,"error","edit/$id");		}}if($action=="del_item"){	$id_menu=$_GET['seg4'];	$sql="DELETE FROM footer_layout_item WHERE id=$id";	$r=$mysql->query($sql);	if($r)	{		msg_warning(_BERHASILHAPUS,"success");		header("location:".backendurl("$modul/edit/$id_menu"));		exit();	}	else	{		msg_warning(_GAGALHAPUS,"error");		header("location:".backendurl("$modul/edit/$id_menu"));		exit();	}}if($action=="del_block_layout"){	$id_menu=$_GET['seg4'];		$sql="DELETE FROM footer_layout_item WHERE id_layout in(SELECT id FROM footer_layout WHERE id_block=$id)";	$r1=$mysql->query($sql);		$sql="DELETE FROM footer_block_layout WHERE id=$id";	$r2=$mysql->query($sql);		$sql="DELETE FROM footer_layout WHERE id_block=$id";	$r=$mysql->query($sql);		if($r and $r1)	{		msg_warning(_BERHASILHAPUS,"success");		header("location:".backendurl("$modul/edit/$id_menu"));		exit();	}	else	{		msg_warning(_GAGALHAPUS,"error");		header("location:".backendurl("$modul/edit/$id_menu"));		exit();	}}if($action=="del_layout"){	$id_menu=$_GET['seg4'];	$sql="DELETE FROM footer_layout WHERE id=$id";	$r=$mysql->query($sql);	$sql="DELETE FROM footer_layout_item WHERE id_layout=$id";	$r1=$mysql->query($sql);	if($r and $r1)	{		msg_warning(_BERHASILHAPUS,"success");		header("location:".backendurl("$modul/edit/$id_menu"));		exit();	}	else	{		msg_warning(_GAGALHAPUS,"error");		header("location:".backendurl("$modul/edit/$id_menu"));		exit();	}}/*ACTION AJAX*/if($action=='refresh_kategori'){echo catstructure('SELECT id, name_id, parent FROM '.$modul.' order by urutan');exit();}if($action=='update_parent'){$list=$_POST['list'];	$urutan=1;		foreach($list as $cat_id =>$parent)	{			if($parent!='' and $parent!='null')		{		$s=$mysql->query("UPDATE $modul SET parent='$parent',urutan=$urutan WHERE id='$cat_id'");		}		else		{		$s=$mysql->query("UPDATE $modul SET parent='0',urutan=$urutan WHERE id='$cat_id'");		}	$urutan++;		}exit();}?>