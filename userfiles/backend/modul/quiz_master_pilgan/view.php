<?php$hariini=date("Y-m-d H:i:s");//if($action==""){$col_back="&nbsp;";	}if($action=="del_confirm"){$sql="SELECT m.*,(select count(*) from quiz_detail q WHERE q.quiz_id=m.id  ) soal FROM $modul m WHERE m.id=$id";$q=$mysql->query($sql);if($q and $mysql->numrows($q)>0){	$d=$mysql->assoc($q);	if($d['soal']>0){	echo	'	<div class="del_confirm">	<div class="del_confirm_title">	Apakah anda yakin mau menghapus paket soal <b>'.$d['title_id'].'</b> terdapat '.$d['soal'].' soal didalamnya?	</div>	<div class="del_confirm_button">	<a class="btn btn-danger" href="'.backendurl("quiz_master/del/$id").'">Hapus</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	<a class="btn btn-inverse" href="'.backendurl("quiz_master").'">Batal</a>	</div>	</div>	';	}else{	header("location:".backendurl("quiz_master/del/$id"));	exit();	}	}else{	header("location:".backendurl("quiz_master"));	exit();}}if($action=="edit"){$kondisi="";if($_SESSION['s_level']==0){	$kondisi=" AND created_by='".$_SESSION['s_id']."'";}	$r=$mysql->query("SELECT * from $modul where id=$id $kondisi");$d=$mysql->assoc($r);$form = new Form("update{$modul}");$form->configure(array(	"prevent" => array("bootstrap", "jQuery", "focus"),	"action" =>backendurl("$modul/update"),	"enctype" =>"multipart/form-data" ));$form->addElement(new Element_HTML('<legend>'._MODULEDIT.'</legend>'));/*if(file_exists("$small_pic/".$d['thumbnail']) and $d['thumbnail']!=''){$thumbimage="$small_url/".$d['thumbnail'];$form->addElement(new Element_HTML('<div><img src="'.$thumbimage.'" /></div>'));} $form->addElement(new Element_File(_THUMBNAIL, "filename"));*/ $form->addElement(new Element_Hidden("form", "update{$modul}"));$form->addElement(new Element_Hidden("id", "$id"));$form->addElement(new Element_Textbox(_KODE,"code",array("required"=>1,"value"=>$d['code'])));$form->addElement(new Element_Textbox(_JUDUL,"title_id", array("required" => 1,"value"=>$d['title_id'])));$form->addElement(new Element_Textbox(_DURASI,"duration",array("required" => 1,"type"=>"number","min"=>"1","value"=>$d['duration'])));$form->addElement(new Element_Textbox(_SKOR,"score",array("required" => 1,"type"=>"number","min"=>"1","value"=>$d['score'])));$form->addElement(new Element_Textbox(_KKM,"kkm",array("required" => 1,"type"=>"number","min"=>"1","value"=>$d['kkm'])));//$form->addElement(new Element_Textarea(_KONTEN,"content_id", array("value"=>$d['content_id'],"class"=>"smalltiny")));$opt_random.='<option value="1" '.($d['is_random']==1?"selected='selected'":"").'>Ya</option>';$opt_random.='<option value="0" '.($d['is_random']==0?"selected='selected'":"").'>Tidak</option>';$form->addElement(new Element_HTML('<div class="control-group"><label for="updatequiz_master-element-3" class="control-label">Acak Soal<span class="required">* </span></label><div class="controls"><select name="is_random" required="required">'.$opt_random.'</select></div></div>'));$opt_random_option.='<option value="1" '.($d['is_random_option']==1?"selected='selected'":"").'>Ya</option>';$opt_random_option.='<option value="0" '.($d['is_random_option']==0?"selected='selected'":"").'>Tidak</option>';$form->addElement(new Element_HTML('<div class="control-group"><label for="updatequiz_master-element-3" class="control-label">Acak pilihan jawaban<br/>(A,B,C,D,E)<span class="required">* </span></label><div class="controls"><select name="is_random_option" required="required">'.$opt_random_option.'</select></div></div>'));//$form->addElement(new Element_Textbox(_URL,"url", array("required" => 1,"value"=>$d['url'])));$form->addElement(new Element_Button(_SIMPAN));$form->addElement(new Element_Button(_BATAL, "button", array(	"onclick" => "history.go(-1);")));$form->render();}if($action=="copy"){Form::clearValues("{$modul}save_as"); 		$kondisi="";if($_SESSION['s_level']==0){	$kondisi=" AND created_by='".$_SESSION['s_id']."'";}	$r=$mysql->query("SELECT * from $modul where id=$id $kondisi");$d=$mysql->assoc($r);$form = new Form("{$modul}save_as");$form->configure(array(	"prevent" => array("bootstrap", "jQuery", "focus"),	"action" =>backendurl("$modul/save_as"),	"enctype" =>"multipart/form-data" ));$form->addElement(new Element_HTML('<legend>'._MODULCOPY.'</legend>'));/*if(file_exists("$small_pic/".$d['thumbnail']) and $d['thumbnail']!=''){$thumbimage="$small_url/".$d['thumbnail'];$form->addElement(new Element_HTML('<div><img src="'.$thumbimage.'" /></div>'));} $form->addElement(new Element_File(_THUMBNAIL, "filename"));*/ $form->addElement(new Element_Hidden("form", "{$modul}save_as"));$form->addElement(new Element_Hidden("id", "$id"));$form->addElement(new Element_Hidden("created_by", $d['created_by']));$form->addElement(new Element_Textbox(_KODE,"code",array("required"=>1,"value"=>$d['code'])));$form->addElement(new Element_Textbox(_JUDUL,"title_id", array("required" => 1,"value"=>$d['title_id'])));$form->addElement(new Element_Textbox(_DURASI,"duration",array("required" => 1,"type"=>"number","min"=>"1","value"=>$d['duration'])));$form->addElement(new Element_Textbox(_SKOR,"score",array("required" => 1,"type"=>"number","min"=>"1","value"=>$d['score'])));$form->addElement(new Element_Textbox(_KKM,"kkm",array("required" => 1,"type"=>"number","min"=>"1","value"=>$d['kkm'])));//$form->addElement(new Element_Textarea(_KONTEN,"content_id", array("value"=>$d['content_id'],"class"=>"smalltiny")));$opt_random.='<option value="1" '.($d['is_random']==1?"selected='selected'":"").'>Ya</option>';$opt_random.='<option value="0" '.($d['is_random']==0?"selected='selected'":"").'>Tidak</option>';$form->addElement(new Element_HTML('<div class="control-group"><label for="updatequiz_master-element-3" class="control-label">Acak Soal<span class="required">* </span></label><div class="controls"><select name="is_random" required="required">'.$opt_random.'</select></div></div>'));$opt_random_option.='<option value="1" '.($d['is_random_option']==1?"selected='selected'":"").'>Ya</option>';$opt_random_option.='<option value="0" '.($d['is_random_option']==0?"selected='selected'":"").'>Tidak</option>';$form->addElement(new Element_HTML('<div class="control-group"><label for="updatequiz_master-element-3" class="control-label">Acak pilihan jawaban<br/>(A,B,C,D,E)<span class="required">* </span></label><div class="controls"><select name="is_random_option" required="required">'.$opt_random_option.'</select></div></div>'));//$form->addElement(new Element_Textbox(_URL,"url", array("required" => 1,"value"=>$d['url'])));$form->addElement(new Element_Button(_SIMPAN));$form->addElement(new Element_Button(_BATAL, "button", array(	"onclick" => "history.go(-1);")));$form->render();}if($action=="add"){$form = new Form("{$modul}add");$form->configure(array(	"prevent" => array("bootstrap", "jQuery", "focus"),	"action" =>backendurl("$modul/save"),	"enctype" =>"multipart/form-data" ));	$form->addElement(new Element_HTML('<legend>'._MODULTAMBAH.'</legend>'));$form->addElement(new Element_Hidden("form", "{$modul}add"));/*$form->addElement(new Element_File(_THUMBNAIL, "filename"));*/$form->addElement(new Element_Textbox(_KODE,"code",array("required" => 1)));$form->addElement(new Element_Textbox(_NAMA,"title_id",array("required" => 1,)));$form->addElement(new Element_Textbox(_DURASI,"duration",array("required" => 1,"type"=>"number","min"=>"1")));$form->addElement(new Element_Textbox(_SKOR,"score",array("required" => 1,"type"=>"number","min"=>"1","value"=>100)));$form->addElement(new Element_Textbox(_KKM,"kkm",array("required" => 1,"type"=>"number","min"=>"1")));$form->addElement(new Element_HTML('<div class="control-group"><label for="updatequiz_master-element-3" class="control-label">Acak Soal<span class="required">* </span></label><div class="controls"><select name="is_random" required="required"><option value="1">Ya</option><option value="0">Tidak</option></select></div></div>'));$opt_random_option.='<option value="1" '.($d['is_random_option']==1?"selected='selected'":"").'>Ya</option>';$opt_random_option.='<option value="0" '.($d['is_random_option']==0?"selected='selected'":"").'>Tidak</option>';$form->addElement(new Element_HTML('<div class="control-group"><label for="updatequiz_master-element-3" class="control-label">Acak pilihan jawaban<br/>(A,B,C,D,E)<span class="required">* </span></label><div class="controls"><select name="is_random_option" required="required">'.$opt_random_option.'</select></div></div>'));/*foreach($list_lang as $i =>$v){$form->addElement(new Element_TinyMCE(_KONTEN,"content_$v",array("class"=>"smalltiny")));}*/$form->addElement(new Element_Button(_SIMPAN));$form->addElement(new Element_Button(_BATAL, "button", array(	"onclick" => "history.go(-1);")));$form->render();}if($action=="" or $action=="search" or $action=="view"){$form_search=form_search($keyword);}if($action=="view" or $action=="" or $action=="search"){Form::clearValues("{$modul}add");	Form::clearValues("{$modul}save_as");	Form::clearValues("update{$modul}");	$col_tambah=button_add("$modul/add/");if($_SESSION['s_level']>1){$col_tambah.="&nbsp;&nbsp;<a class=\"btn btn-upload\" href=\"#\" onclick=\"$('.upload_master').show();\">Restore Master Soal(*.gz)</a>";$col_tambah.="&nbsp;&nbsp;<a class=\"btn btn-download\" onclick=\"document.getElementById('form_list_master').submit();\">Backup Master Soal(*.gz)</a>";$col_tambah.="&nbsp;&nbsp;<span class=\"upload_master\" style=\"display:none;\"><form method=\"post\" enctype=\"multipart/form-data\" action=\"".backendurl("$modul/upload")."\">File Master (*.gz)<input type=\"file\" accept=\"gz/*\" name=\"filename\" required=\"required\"><button type=\"submit\" class=\"btn btn-primary\" name=\"proses_upload\" value=\"1\" />Submit Soal</button></form></span>";}$sql="SELECT m.*,(select count(id) from quiz_detail q WHERE q.quiz_id=m.id  ) multiple,(select count(id) from quiz_essay q WHERE q.quiz_id=m.id  ) essay,u.username,('$hariini' <= DATE_ADD(created_date, INTERVAL 5 MINUTE)) soal_baru FROM $modul m LEFT JOIN user u ON m.created_by=u.id ";$sql_r=array();$sql_search=array();if($_SESSION['s_level']==0){	$sql_r[]="m.created_by='".$_SESSION['s_id']."'";}if($action=="search"){$sql_search[]=" title_id LIKE '%$keyword%' ";$sql_search[]=" duration LIKE '%$keyword%' ";$sql_search[]=" kkm LIKE '%$keyword%' ";$sql_search[]=" code LIKE '%$keyword%' ";$join_keyword=join(" OR ",$sql_search);$sql_r[]=" ($join_keyword) ";}if(count($sql_r)>0){$join_condition=join(" AND ",$sql_r);	$sql.=" WHERE $join_condition";}$r=$mysql->query($sql);$total_records = $mysql->numrows($r);$start = $screen * $max_page_list;$pages = ceil($total_records/$max_page_list);if ($pages>1) $col_pagination=pagination($screen);$sql.="  order by $sort_by $sort_order  LIMIT $start, $max_page_list";$r=$mysql->query($sql);echo "<form method='post' id='form_list_master' name='form_list_master' action='".backendurl("$modul/download")."'><table id='DataTables_Table_3_wrapper' class='view-table table table-hover table-nomargin table-bordered '>";echo "<thead><tr><th>No</th>";//<th>"._THUMBNAIL."</th>echo "<th>".orderBy("code",_KODE,$sort_order,$sort_by)."</th>";echo "<th>".orderBy("title_id",_JUDUL,$sort_order,$sort_by)."</th>";echo "<th>".orderBy("duration",_DURASIICO,$sort_order,$sort_by)."</th>";echo "<th>".orderBy("score",_SKOR	,$sort_order,$sort_by)."</th>";echo "<th>".orderBy("kkm",_KKM	,$sort_order,$sort_by)."</th>";echo "<th>".orderBy("is_random",_RANDOM,$sort_order,$sort_by)."</th>";echo "<th>".orderBy("username",_CREATOR,$sort_order,$sort_by)."</th>";echo "<th>".orderBy("soal",_SOAL,$sort_order,$sort_by)."</th>";echo "<th>Action</th>";echo "</tr></thead>";$no=($start+1);if($mysql->numrows($r)>0){echo '<tbody id="brand_row" class="ui-sortable">';while($d=$mysql->assoc($r)){echo "<tr id='list_{$d['id']}' class='rowmove".($d['soal_baru']==1?" soal_baru":"")."'><td>$no ".($_SESSION['s_level']>1?"<input type='checkbox' name='id_master[]' value='".$d['id']."' />":"")."</td>";/*$thumbnail_url="$small_url/".$d['thumbnail'];$thumbnail_path="$small_pic/".$d['thumbnail'];if(file_exists("$thumbnail_path")){echo "<td class='brand_thumbnail'><img src='".$thumbnail_url."'/></td>";}else{echo "<td>&nbsp;</td>";}*/echo "<td>".$d["code"]."</td>";echo "<td>".$d["title_id"]."</td>";echo "<td>".$d["duration"]."</td>";echo "<td>".$d["score"]."</td>";echo "<td>".$d["kkm"]."</td>";echo "<td>".($d["is_random"]==1?"Y":"N").($d["is_random_option"]==1?"Y":"N")."</td>";echo "<td>".$d["username"]."</td>";echo "<td> <a class='button_action kelola_soal'  href='".backendurl("quiz_detail/view?id_soal=".$d['id'])."'><i class=\"glyphicon-book_open\"></i>Soal ".$d["multiple"]."</a></td>";//<img alt=\"View\" border=\"0\" src=\"".backendurl("images/view.png")."\">/*	if($d["soal"]<=0){	$ar_action=array("edit"=>$d['id'],"del"=>$d['id']);}else{$ar_action=array("edit"=>$d['id']);}*/ $ar_action=array("edit"=>$d['id']);echo "<td>";echo "<a title='Copy/Simpan soal dengan kode berbeda' class='button_action' href='".backendurl("quiz_master/copy/".$d['id'])."'>			<i class='icon-copy'></i></a>		  </a>";	$ar_action["del_confirm"]=$d['id'];	echo button_action($ar_action);echo "</td>";echo "</tr>";$no++;}echo "</tbody>";}echo "</table>";echo "</form>";}?>