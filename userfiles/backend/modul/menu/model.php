<?phpif($action=="save"){	$url_empty=array();	$url_noempty="";	foreach($list_lang as $i =>$v)	{	${"name_$v"}=cleanInput($_POST["name_$v"]);	${"description_$v"}=allowHtml($_POST["description_$v"]);	if(${"name_$v"}!="")$nama=1;	${"url_$v"}=cleanInput($_POST["name_$v"],"url");	if(${"url_$v"}==""){$url_empty[]="url_$v";}	if($url_noempty=="" and ${"url_$v"}!=""){$url_noempty="url_$v";}	}	//jika ada url yang kosong ambil yang pertama tidak kosong	if(count($url_empty)>0)	{		foreach($url_empty as $i =>$v)		{		$$v=$$url_noempty;		}	}	$urutan =cleanInput($_POST['urutan']);	$parent =cleanInput($_POST['parent'],'numeric');		if(!$nama)redirecto(_FIELDNAMABLANK,"error","view");							//if (!preg_match('/[0-9]*/',$urutan)) $urutan=1;				$urutan = getMaxNumber($modul, 'urutan',"parent='".$parent."' ")+2;		$newid = getMaxNumber($modul, 'id')+1;		$sql = "INSERT INTO $modul (id ";		foreach($list_lang as $i =>$v)		{		$sql.= ",name_$v";		$sql.=",url_$v";		}				$sql.= ",parent,urutan) values ($newid ";		foreach($list_lang as $i =>$v)		{		$sql.= ",'".${"name_$v"}."'";		$sql.=",'".${"url_$v"}."'";		}		if($modifiedfilename!="")		{			$sql.=",'".$modifiedfilename."'";		}		$sql.= ",'$parent','$mx')";						$result = $mysql->query($sql);				$r = urutkan($modul, $urutan, "parent='".$parent."' ", $newid, "parent='".$parent."' ");				if($r)		{		redirecto(_BERHASILTAMBAH,"success","view");		}		else		{		redirecto(_GAGALTAMBAH,"error","view");		}		}if($action=="update"){		$id=cleanInput($_POST['id'],'numeric');	$url_empty=array();	$url_noempty="";	foreach($list_lang as $i =>$v)	{	${"name_$v"}=cleanInput($_POST["name_$v"]);	if(${"name_$v"}!="")$nama=1;		${"url_$v"}=cleanInput($_POST["name_$v"],"url");	if(${"url_$v"}==""){$url_empty[]="url_$v";}	if($url_noempty=="" and ${"url_$v"}!=""){$url_noempty="url_$v";}	}	//jika ada url yang kosong ambil yang pertama tidak kosong	if(count($url_empty)>0)	{		foreach($url_empty as $i =>$v)		{		$$v=$$url_noempty;		}	}	$urutan =cleanInput($_POST['urutan']);	$parent =cleanInput($_POST['parent'],'numeric');		if($nama=='')redirecto(_FIELDNAMABLANK,"error","edit/$id");						if (!preg_match('/[0-9]*/',$urutan)) $urutan=1;						$sql = "UPDATE $modul SET parent='$parent' ";			foreach($list_lang as $i =>$v)		{		$sql.= ",name_$v='".${"name_$v"}."'";		$sql.=",url_$v='".${"url_$v"}."'";		}				$sql.=" WHERE id=$id";				$result = $mysql->query($sql);		//$r = urutkan('category', $urutan, "parent='".$parent."' ", $id, "parent='".$parent."'");	if($result)	{	redirecto(_BERHASILUPDATE,"success","view");   	}	else	{	redirecto(_GAGALUPDATE,"error","view");  	}					}if($action=="del"){$r=$mysql->query("SELECT filename from $modul WHERE id='$id'");list($oldfilename)=$mysql->row($r);$sql="DELETE FROM $modul WHERE id=$id";$r=$mysql->query($sql);$r=true;if($r){	//del block layout	$del=$mysql->query("DELETE FROM menu_block_layout WHERE id_menu=(SELECT id FROM menu_layout WHERE id_menu='$id' )");		//del item	$del=$mysql->query("DELETE FROM menu_layout_item WHERE id_layout=(SELECT id FROM menu_layout WHERE id_menu='$id' )");			//del menu_layout	$del=$mysql->query("DELETE FROM menu_layout WHERE id_menu='$id'");			//del gambar	if(file_exists("$large_pic/$oldfilename"))unlink("$large_pic/$oldfilename");	if(file_exists("$small_pic/$oldfilename"))unlink("$small_pic/$oldfilename");	msg_warning(_BERHASILHAPUS,"success");	header("location:".backendurl("$modul/view"));	exit();}else{	msg_warning(_GAGALHAPUS,"error");	header("location:".backendurl("$modul/view"));	exit();}}/*ACTION AJAX*/if($action=='refresh_kategori'){echo catstructure('SELECT id, name_id, parent FROM '.$modul.' order by urutan');exit();}if($action=='update_parent'){$list=$_POST['list'];	$urutan=1;		foreach($list as $cat_id =>$parent)	{			if($parent!='' and $parent!='null')		{		$s=mysql_query("UPDATE $modul SET parent='$parent',urutan=$urutan WHERE id='$cat_id'");		}		else		{		$s=mysql_query("UPDATE $modul SET parent='0',urutan=$urutan WHERE id='$cat_id'");		}	$urutan++;		}exit();}?>