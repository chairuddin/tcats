<?php/*Catatan pakai yona-validation:Form :	Form menggunakan class yona-validation	Tombol submit name=submitVar  : nama element harus sama dengan var   * */$hari_ini=date("Y-m-d H:i:s");$admin_id=$_SESSION['s_id'];		$validation->set_validation(array('var'=>'name','label'=>'Judul'))->required();$validation->set_validation(array('var'=>'id_level','label'=>'Tingkat'))->required();$validation->set_validation(array('var'=>'id_lesson','label'=>'Mata Pelajaran'))->required();$validation->set_validation(array('var'=>'id_major','label'=>'Bidang Studi'))->required();$validation->set_validation(array('var'=>'year','label'=>'Tahun Ajaran'))->required();$validation->set_validation(array('var'=>'competency_rows','label'=>'Jumlah KD'))->required();$validation->generate_js_validation();if($action=="save" or $action=="update") {	$id=$_POST['id'];		if($validation->valid()){		$r_post=array(		'name',		'semester',		'id_level',		'id_lesson',		'id_major',		'competency_rows',		'year'		);				$sql_r = array();				if($action=="save") {			$sql_r[]="created_by='$admin_id'";			$sql_r[]="created_date='$hari_ini'";		}				if($action=="update") {			$sql_r[]="modified_by='$admin_id'";			$sql_r[]="modified_date='$hari_ini'";		}						foreach($r_post as $i => $v) {			$post=$_POST[$v];			$sql_r[]="$v = '".addslashes($post)."'";		}				if($action=="save") {			$sql=" INSERT INTO $modul SET ".join(" ,",$sql_r);			$q=$mysql->query($sql);			$last_id=$mysql->insert_id();		}				if($action=="update") {			$sql=" UPDATE $modul SET ".join(" ,",$sql_r)." WHERE id=$id ";			$q=$mysql->query($sql);		}						} else {		sweetalert2($type="warning",$msg=($action=="update"?"Update":"Tambah")." $title gagal, data tidak valid",backendurl("$modul".($action=="update"?"/edit/$id":"/add")));	}		if($q){		sweetalert2($type="success",$msg=($action=="update"?"Update":"Tambah")." $title berhasil",backendurl("$modul"));	} else {		sweetalert2($type="warning",$msg=($action=="update"?"Update":"Tambah")." $title gagal. ",backendurl("$modul".($action=="update"?"/edit/$id":"/add")));	}	}if($action=="del"){$id=cleanInput($id,'numeric');	$valid=true;	$mysql->autocommit(false);		$sql="DELETE FROM $modul WHERE id='$id'";	$r=$mysql->query($sql);	if($r and $valid){		$mysql->commit();		$mysql->autocommit(true);		sweetalert2($type="success",$msg="Hapus $title berhasil",backendurl("$modul"));	} else {		$mysql->rollback();			sweetalert2($type="warning",$msg="Hapus $title gagal",backendurl("$modul"));	}	}if($action=="uploadwordx"){ 	$new_filename=change_filename($_FILES['file_wordx']['name'],$_GET['id_sylabus']);	$destination=$config['userdir'].'backend/modul/'.$modul.'/backup/'.$new_filename;	//$filename=$_FILES['file_wordx']['name'];	$filename=$new_filename;	if (!move_uploaded_file($_FILES['file_wordx']['tmp_name'], $destination)) {		sweetalert2($type="warning",$msg="Gagal upload template",backendurl("$modul/form?id_sylabus=".$_GET['id_sylabus']));	}  else {		sweetalert2($type="success",$msg="Preview silabus",backendurl("$modul/view_sylabus/".$_GET['id_sylabus']));	}	}