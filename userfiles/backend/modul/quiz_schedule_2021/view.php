<?php$hariini=date("Y-m-d H:i:s");if($action=="get_kelas") {	$grade=$_GET['grade'];	$option_soal=[];		$sql="SELECT class FROM quiz_member WHERE  grade='$grade'   ";	if($level_user==0) {		$sql .=" AND class IN ($config_join_class) ";	}	$sql .= " ORDER BY class ";	$q=$mysql->query($sql);	if($q and $mysql->num_rows($q)>0) {		while($d=$mysql->fetch_assoc($q)) {			$option_class[$d['class']]=$d['class'];		}	}	$form_class=$form->element_Select2Multi("Pilih Kelas",'allow_class[]',$option_class,array('class'=>'select2','multiple'=>"multiple"));	echo $form_class;		die();}if($action=="get_soal") {	$grade=$_GET['grade'];	$option_soal=[];		$sql="SELECT id,concat(code,' ',title_id) title_id FROM quiz_master WHERE  grade='$grade'  ";		$sql .= " ORDER BY code,title_id ";	$q=$mysql->query($sql);	if($q and $mysql->num_rows($q)>0) {		while($d=$mysql->fetch_assoc($q)) {			$option_soal[$d['id']]=$d['title_id'];		}	}	echo $form_quiz_id=$form->element_Select("Pilih Soal",'quiz_id',$option_soal,array('class'=>'select2'));	die();}if($action=="del_confirm"){list($schedule_data)=$mysql->query_data("SELECT * FROM quiz_schedule WHERE id=$id ");//var_dump($schedule_data);$quiz_info=json_decode($schedule_data['quiz_info'],true);$sql="SELECT id FROM quiz_done WHERE schedule_id=$id AND is_done=1 ";$q=$mysql->query($sql);if($q and $mysql->numrows($q)>0){	$total_ujian=$mysql->numrows($q);		$d=$mysql->assoc($q);	if($total_ujian>0){	echo	'	<div class="row">	<div class="col-md-6">		<div class="card">			<div class="card-header">			  <h3 class="card-title">Konfirmasi Hapus</h3>			</div>			<!-- /.card-header -->			<div class="card-body">							<div class="del_confirm">			<div class="del_confirm_title">			<p>			Sudah ada peserta ujian  <b>'.$quiz_info['title_id'].'</b> dengan total  '.$total_ujian.' peserta?			</p>			</div>			<div class="del_confirm_button">			<a class="btn btn-danger" href="'.backendurl("quiz_schedule/del/$id").'">Hapus</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;			<a class="btn btn-default" href="'.backendurl("quiz_schedule").'">Batal</a>			</div>			</div>			</di>		</div>		</div>	</div>		';	//			<a class="btn btn-danger" href="'.backendurl("quiz_schedule/del/$id?arsip=1").'">Hapus & Arsipkan</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	}else{	header("location:".backendurl("quiz_schedule/del/$id"));	exit();	}	}else{	header("location:".backendurl("quiz_schedule/del/$id"));	exit();}}if($action=="add" OR $action=="edit"){if($_SESSION['s_level']==0){	$kondisi="  1=1 ";	//$kondisi="  created_by='".$_SESSION['s_id']."'";} else {	$kondisi="  1=1 ";}if($action=='edit') {		$q=$mysql->query("	SELECT 		grade,		token,		quiz_id,		allow_class,		date_format(tanggal,'%d/%m/%Y') exam_date,		date_format(tanggal,'%H:%i') exam_time,		date_format(tanggal_expired,'%d/%m/%Y') exam_date_expired,		date_format(tanggal_expired,'%H:%i') exam_time_expired	FROM		quiz_schedule WHERE id=$id	");	$d=$mysql->assoc($q);	$r_allow_class=$d['allow_class'];	foreach($d as $field => $value) {		$_POST[$field]=$_POST[$field]==''?$value:$_POST[$field];	}	$_POST['allow_class']=explode(",",$r_allow_class);	}$kondisi="";	if($level_user==0) {	//$kondisi1=" nama IN ($config_join_grade) ";	//$kondisi2=" WHERE grade IN ($config_join_grade) ";	//$kondisi2=" WHERE created_by='".$_SESSION['s_id']."'";}$list_grade=$mysql->get_assoc('nama','nama','quiz_grade','nama',$kondisi1);	if($_POST['is_late']=="") {	//default bebas	$_POST['is_late']=1;}$do_action=backendurl("$modul/".($action=="add"?"save":"update"));$label_action=$action=="add"?"Tambah":"Edit";$selected=$pilih_cabang;$default_text='';if(count($data_cabang)>1) { 	$default_text='Pilih soal';}$option_soal=[];$q=$mysql->query("SELECT id,concat(code,' ',title_id) title_id FROM quiz_master $kondisi2 ORDER BY code,title_id ");if($q and $mysql->num_rows($q)>0) {	while($d=$mysql->fetch_assoc($q)) {		$option_soal[$d['id']]=$d['title_id'];	}}//$option_soal= $mysql->get_assoc('id'," concat(code,' ',title_id) title_id ",'quiz_master','code'," $kondisi ");//$form_grade= $form->element_Select("Pilih Grade","grade",$list_grade,array('onchange'=>'pilih_soal();pilih_kelas();') );$form_quiz_id=$form->element_Select("Pilih Soal",'quiz_id',$option_soal,array('class'=>'select2'));$form_exam_date=$form->element_Textbox("Tanggal Mulai","exam_date",array('autocomplete'=>'off'));$form_exam_time=$form->element_Textbox("Jam Mulai","exam_time",array('autocomplete'=>'off'));//$form_tepat_waktu=$form->element_Switch("Waktu Bebas","is_late",array("value"=>1));//$form_tepat_waktu=$form->element_bootstrapSwitch("Waktu Ujian","is_late",array("value"=>"1",'data-off-color'=>"primary",'data-on-color'=>"success",'data-on-text'=>"Flexible", 'data-off-text'=>"On Time"));$form_exam_date_expired=$form->element_Textbox("Tanggal Kadaluarsa","exam_date_expired",array('autocomplete'=>'off'));$form_exam_time_expired=$form->element_Textbox("Jam Kadaluarsa","exam_time_expired",array('autocomplete'=>'off'));$option_class= $mysql->get_assoc('class','class','quiz_member',"class","class<>''",'class');$form_class=$form->element_Select2Multi("Pilih Kelas",'allow_class[]',$option_class,array('class'=>'select2','multiple'=>"multiple","value"=>$_POST['allow_class']));$form_token=$form->element_Textbox("Token","token",array('placeholder'=>"Otomatis"));/*<div class="form-group">			$form_tepat_waktu </div>  <div class="form-group">						<div class="row">							<div class="col-md-5">								$form_grade                 							</div>						</div>                  </div>*/  echo <<<END  <div class="card card-navy">              <div class="card-header">                <h3 class="card-title">$label_action Jadwal</h3>              </div>              <!-- /.card-header -->              <!-- form start -->              <form role="form" method="POST" id="form-member"  class="form-member yona-validation" action="$do_action"  novalidate enctype="multipart/form-data">				<input type="hidden" name="id" value="$id" />                <div class="card-body">                                  <div class="form-group">						<div class="row">							<div class="col-md-5" id="form_pilih_soal">								$form_quiz_id                 							</div>						</div>                  </div>					<div class="form-group">						  <div class="row">							<div class="col-md-3 col-sm-6">								$form_exam_date   							</div>							<div class="col-md-2 col-sm-6">								$form_exam_time							</div>						  </div>					</div>									<div class="form-group">						  <div class="row">							<div class="col-md-3  col-sm-6">								$form_exam_date_expired   							</div>							<div class="col-md-2  col-sm-6">								$form_exam_time_expired							</div>						  </div>					</div>					<div class="form-group">					<div class="row">								<div class="col-md-5" id="form_pilih_kelas">									$form_class								</div>						</div>					                 					</div>					<div class="form-group">						<div class="row">								<div class="col-md-5">									$form_token								</div>						</div>					                 					</div>                  </div>                     <div class="card-footer">                   <button type="button" class="btn btn-default" onclick="history.back(-1);">Batal</button>&nbsp;&nbsp;&nbsp;<button type="submit" name="submit" value="1" class="btn btn-primary">Submit</button>                </div>              </form>            </div>            <!-- /.card -->END;$url_soal = backendurl("$modul/get_soal?grade=");$url_kelas = backendurl("$modul/get_kelas?grade=");$script_js=<<<END<script>function pilih_soal() {   grade = document.getElementById("grade").value;   var jqxhr = $.get( "$url_soal"+grade, function(data) {	document.getElementById("form_pilih_soal").innerHTML=data;   }).done(function() {     $('.select2').select2();  }).fail(function() {		Swal.fire({		icon: 'error',		title: 'Gagal request data',		text: 'Silahkan refresh halaman',		});  });}function pilih_kelas() {   grade = document.getElementById("grade").value;   var jqxhr = $.get( "$url_kelas"+grade, function(data) {	document.getElementById("form_pilih_kelas").innerHTML=data;   }).done(function() {     $('.select2').select2();  }).fail(function() {		Swal.fire({		icon: 'error',		title: 'Gagal request data',		text: 'Silahkan refresh halaman',		});  });}$(document).ready(function(){						var dexam_time = $("#exam_time").timepicker({ uiLibrary: 'materialdesign',keyboardNavigation: true, modal: true});		var dexam_date = $("#exam_date").datepicker({  keyboardNavigation: true, modal: true, header: true, footer: true, format: 'dd/mm/yyyy' });		var dexam_time_expired = $("#exam_time_expired").timepicker({ uiLibrary: 'materialdesign',keyboardNavigation: true, modal: true});		var dexam_date_expired = $("#exam_date_expired").datepicker({  keyboardNavigation: true, modal: true, header: true, footer: true, format: 'dd/mm/yyyy' });				//new GijgoTimePicker(document.getElementById("exam_time"), { uiLibrary: 'materialdesign',keyboardNavigation: true, modal: true});	 	//new GijgoDatePicker(document.getElementById("exam_date"), { keyboardNavigation: true, modal: true, header: true, footer: true, format: 'dd/mm/yyyy' });		//new GijgoDatePicker(document.getElementById("exam_date_expired"), { keyboardNavigation: true, modal: true, header: true, footer: true, format: 'dd/mm/yyyy' });		//new GijgoTimePicker(document.getElementById("exam_time_expired"), { uiLibrary: 'materialdesign',keyboardNavigation: true, modal: true});		/*			$('#is_late').on('switchChange.bootstrapSwitch', function (event, state) {		if(state) {			//$("#exam_time_expired").removeAttr("readonly");			//$("#exam_date_expired").removeAttr("readonly");			//$("#exam_date_expired").next().show();			//$("#exam_time_expired").next().show();						//new GijgoDatePicker(document.getElementById("exam_date_expired"), { keyboardNavigation: true, modal: true, header: true, footer: true, format: 'dd/mm/yyyy' });			//new GijgoTimePicker(document.getElementById("exam_time_expired"), { uiLibrary: 'materialdesign',keyboardNavigation: true, modal: true});				} else {			dexam_time_expired.destroy();			dexam_date_expired.destroy();			setTimeout(function(){				$("#exam_time_expired").attr("readonly","readonly");				$("#exam_date_expired").attr("readonly","readonly");				$("#exam_date_expired").next().hide();				$("#exam_time_expired").next().hide();			},1000);									//new GijgoDatePicker(document.getElementById("exam_date_expired")).destroy();			//new GijgoTimePicker(document.getElementById("exam_time_expired")).destroy();				}		}); 		*/		});</script>END;}/*if($action=="add" OR $action=="edit"){$r=$mysql->query("SELECT * from $modul where id=$id");$d=$mysql->assoc($r);$form = new Form("update{$modul}");$form->configure(array(	"prevent" => array("bootstrap", "jQuery", "focus"),	"action" =>backendurl("$modul/update"),	"enctype" =>"multipart/form-data" ));$form->addElement(new Element_HTML('<legend>'._MODULEDIT.'</legend>'));$form->addElement(new Element_Hidden("form", "update{$modul}"));$form->addElement(new Element_Hidden("id", "$id"));$exam_date=date("d/m/Y",strtotime($d['tanggal']));$exam_time=date("H:i",strtotime($d['tanggal']));$exam_date_expired=date("d/m/Y",strtotime($d['tanggal_expired']));$exam_time_expired=date("H:i",strtotime($d['tanggal_expired']));$kondisi="";if($_SESSION['s_level']==0){	$kondisi=" WHERE created_by='".$_SESSION['s_id']."'";}$quiz_data=$mysql->query_data("SELECT * FROM quiz_master $kondisi ORDER BY code ASC ");$quiz_option='<option value="">Pilih Soal</option>';if(count($quiz_data)>0){	foreach($quiz_data as $qd){		$selected=$qd['id']==$d['quiz_id']?"selected='selected'":"";		$quiz_option.='<option value="'.$qd['id'].'" '.$selected.'>'.$qd['code'].' - '.$qd['title_id'].'</option>';	} }$form->addElement(new Element_HTML('<div class="control-group"><label for="updatequiz_master-element-3" class="control-label">Soal Uji<span class="required">* </span></label><div class="controls"><select id="quiz_id" name="quiz_id" required="required" onchange="update_quiz_select(this.value)">'.$quiz_option.'</select></div></div>'));$quiz_data=$mysql->query_data("SELECT * FROM quiz_master WHERE id='".$d['quiz_id']."'");list($quiz_data)=$quiz_data;$form->addElement(new Element_HTML('<div class="control-group"><label for="updatequiz_master-element-3" class="control-label"></label><div id="quiz_info" class="controls">	<table>	<tr><td>Kode</td><td>:</td><td>'.$quiz_data['code'].'</td></tr>	<tr><td>Soal</td><td>:</td><td>'.$quiz_data['title_id'].'</td></tr>	<tr><td>Durasi</td><td>:</td><td>'.$quiz_data['duration'].'</td></tr>	<tr><td>KKM</td><td>:</td><td>'.$quiz_data['kkm'].'</td></tr>	<tr><td>Acak Soal</td><td>:</td><td>'.($quiz_data['is_random']==1?"Ya":"Tidak").'</td></tr>	<tr><td>Acak Pilihan</td><td>:</td><td>'.($quiz_data['is_random_option']==1?"Ya":"Tidak").'</td></tr>	</table>	</div></div>'));$late_checked=$d['is_late']==1?'checked="checked"':'';$form->addElement(new Element_HTML('<div class="control-group"><label for="updatequiz_master-element-3" class="control-label"></label><div class="controls"><input type="checkbox" id="is_late" name="is_late" value="1" '.$late_checked.' /> Tepat waktu</div></div>'));$form->addElement(new Element_HTML('<div class="control-group"><label for="updatequiz_master-element-3" class="control-label">Tanggal Uji</label><div class="controls">  <div id="datetimepicker1" class="input-append date">    <input data-format="dd/MM/yyyy" type="text" id="exam_date" name="exam_date" value="'.$exam_date.'" required="required"></input>    <span class="add-on">      <i data-time-icon="icon-time" data-date-icon="icon-calendar">      </i>    </span>  </div>  Pukul  <div id="datetimepicker2" class="input-append date">    <input data-format="hh:mm" type="text" id="exam_time" name="exam_time"  value="'.$exam_time.'" required="required"></input>    <span class="add-on">      <i data-time-icon="icon-time" data-date-icon="icon-calendar">      </i>    </span>  </div>  </div></div><script type="text/javascript">  $(function() {    $("#datetimepicker1").datetimepicker({      language: "pt-BR",      pickTime: false,      startDate:"'.$exam_date.'"    });  });  $("#datetimepicker1,#datetimepicker2").on("changeDate", function(e) {	set_kadaluarsa();		});    $(function() {    $("#datetimepicker2").datetimepicker({      language: "pt-BR",      pickDate: false,      pickSeconds: false    });  });  </script>'));$form->addElement(new Element_HTML('<div class="control-group" id="div_kadaluarsa"><label for="updatequiz_master-element-3" class="control-label">Kadaluarsa</label><div class="controls">  <div id="datetimepicker3" class="input-append date">    <input data-format="dd/MM/yyyy" type="text" id="exam_date_expired" name="exam_date_expired" value="'.$exam_date_expired.'" required="required"></input>    <span class="add-on">      <i data-time-icon="icon-time" data-date-icon="icon-calendar">      </i>    </span>  </div>  Pukul  <div id="datetimepicker4" class="input-append date">    <input data-format="hh:mm" type="text" id="exam_time_expired" name="exam_time_expired"  value="'.$exam_time_expired.'" required="required"></input>    <span class="add-on">      <i data-time-icon="icon-time" data-date-icon="icon-calendar">      </i>    </span>  </div>  </div></div><script type="text/javascript">  $(function() {    $("#datetimepicker3").datetimepicker({      language: "pt-BR",      pickTime: false,       startDate:"'.$exam_date.'",    });  });    $(function() {    $("#datetimepicker4").datetimepicker({      language: "pt-BR",      pickDate: false,      pickSeconds: false,    });  });  </script>'));$r_allow_class=explode(",",$d['allow_class']);$quiz_class=$mysql->query_data("SELECT distinct class FROM quiz_member ORDER BY class ASC ");$allclass=array();if(count($quiz_class)>0){	foreach($quiz_class as $qd){		$allclass[]=$qd['class'];	}}$allclass=join(",",$allclass);$quiz_class_option='<ul class="pilih_kelas">';$quiz_class_option.='<li><input class="class_all" type="checkbox" value="0" name="check_all" />Semua Kelas</li>';if(count($quiz_class)>0){	foreach($quiz_class as $qd){		$checked=in_array($qd['class'],$r_allow_class);		$quiz_class_option.='<li><input class="class_select"  name="allow_class[]" '.($checked==1?"checked='checked'":"").' type="checkbox" value="'.$qd['class'].'" />'.$qd['class'].'</li>';	} }$quiz_class_option.='</ul>';$form->addElement(new Element_HTML('<div class="control-group"><label for="updatequiz_master-element-3" class="control-label">Pilih Kelas</label><div class="controls">'.$quiz_class_option.'</div></div>'));$form->addElement(new Element_Button(_SIMPAN));$form->addElement(new Element_Button(_BATAL, "button", array(	"onclick" => "history.go(-1);")));$form->render();}*/if($action=="info" and $id!="") {$info_ujian = info_ujian($id);$jadwal=$mysql->query("SELECT  allow_class,quiz_info,token FROM quiz_schedule WHERE id=$id")->fetch_assoc();$quiz_info=json_decode($jadwal['quiz_info'],true);$token=$jadwal['token'];$kelas=$jadwal['allow_class'];$r_kelas = explode(",",$kelas);$join_kelas = "'".join("','",$r_kelas);$nama_kelas_sambung = join(", ",$r_kelas);$tampilan_jumlah_kelas='';foreach($r_kelas as $x => $value) {$total_peserta = $mysql->get1value("SELECT count(id)+0 jml FROM quiz_member WHERE class='$value' ");	$sudah_ujian = $mysql->get1value("SELECT count(id) jml FROM quiz_done WHERE member_class='$value'  AND schedule_id= $id ");	$tombol_download='';if($sudah_ujian>0) {	$tombol_download='<a href="'.fronturl("get_excel/?schedule_id=".$id."&class=$value").'"><span class="progress-download-xls"><i class="fas fa-download"></i>&nbsp;Excel</span></a>&nbsp;&nbsp;&nbsp;';}$belum_ujian = $total_peserta - $sudah_ujian; $persen = ($sudah_ujian / $total_peserta) * 100;$persen = round($persen,2);$tampilan_jumlah_kelas .= '			<div class="progress-group">			  '.$value.'			  <span class="float-right">'.$tombol_download.'<b>'.$sudah_ujian.'</b>/'.$total_peserta.'</span>			  <div class="progress progress-sm">				<div class="progress-bar bg-success" style="width: '.$persen.'%"></div>			  </div>			</div>';}/*JUMLAN PESERTA BERDASARKAN KELAS*/$url_belum_ujian = backendurl("quiz_realtime/?filter=belum_ujian&schedule_id=$id");$url_sedang_ujian = backendurl("quiz_ongoing/?filter=sedang_ujian&schedule_id=$id");$url_pending_ujian = backendurl("quiz_ongoing/?filter=pending&schedule_id=$id");$url_sudah_ujian = backendurl("quiz_ongoing/?filter=sudah_ujian&schedule_id=$id");echo <<<END			            <div class="row"><div class="col-md-12">		<div class="card">		  <div class="card-header">			<h3 class="card-title">Monitor Ujian $quiz_info[title_id]</h3>			<div class="card-tools">			  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-minus"></i>			  </button>			  <button type="button" class="btn btn-tool" data-card-widget="remove"><i class="fas fa-times"></i>			  </button>			</div>		  </div>		  <!-- /.card-header -->		  <div class="card-body">			<div class="row">			  <div class="col-md-6">				  <table>						<tr><td valign="top">Token</td><td valign="top">:</td><td>$token</td></tr>						<tr><td valign="top">Kode</td><td valign="top">:</td><td>$quiz_info[code]</td></tr>						<tr><td valign="top">Soal</td><td valign="top">:</td><td>$quiz_info[title_id]</td></tr>						<tr><td valign="top">Durasi</td><td valign="top">:</td><td>$quiz_info[duration] Menit</td></tr>						<tr><td valign="top">Kelas</td><td valign="top">:</td><td><div style="font-size:10pt;">$nama_kelas_sambung</div></td></tr>				 </table>			  </div>			  <div class="col-md-3">				<div class="chart-responsive">				  <canvas id="pieChart" height="150"></canvas>				</div>				<!-- ./chart-responsive -->			  </div>			  <!-- /.col -->			  <div class="col-md-3">				<ul class="chart-legend clearfix">				  <li>					  <a  class="badge badge-secondary" href="$url_belum_ujian">Belum($info_ujian[belum_ujian]/$info_ujian[total_peserta]) $info_ujian[belum_ujian_prosentase]%</a>				  </li>				  <li>					<a class="badge badge-warning" href="$url_sedang_ujian">Sedang($info_ujian[sedang_ujian]) $info_ujian[sedang_ujian_prosentase]% </a>										</li>				  <li>					<a class="badge badge-danger" href="$url_pending_ujian">Pending($info_ujian[reset_ujian]) $info_ujian[reset_ujian_prosentase]%</a>					</li>				  <li>					<a class="badge badge-success" href="$url_sudah_ujian">Sudah($info_ujian[sudah_ujian]/$info_ujian[total_peserta]) $info_ujian[sudah_ujian_prosentase]%  </a>					</li>				</ul>			  </div>			  <!-- /.col -->			</div>			<!-- /.row -->		  </div>		  <!-- /.card-body -->		</div>		<!-- /.card -->				<!-- -->	</div>	</div>END;$script_js .=<<<END<script>$(document).ready(function(){var pieChartCanvas = $('#pieChart').get(0).getContext('2d')    var pieData        = {      labels: [          'Belum Ujian',           'Sedang Ujian',          'Pending Ujian',          'Sudah Ujian'       ],      datasets: [        {          data: [$info_ujian[belum_ujian],$info_ujian[sedang_ujian],$info_ujian[reset_ujian],$info_ujian[sudah_ujian]],          backgroundColor : ['#d2d6de', '#f39c12', '#f56954', '#00a65a'],        }      ]    }    var pieOptions     = {      legend: {        display: false      }    }    //Create pie or douhnut chart    // You can switch between pie and douhnut using the method below.    var pieChart = new Chart(pieChartCanvas, {      type: 'doughnut',      data: pieData,      options: pieOptions          })});</script>END;}if($action=="jawaban" and $id!="") {$info_ujian = info_ujian($id);$jadwal=$mysql->query("SELECT  allow_class,quiz_info,token FROM quiz_schedule WHERE id=$id")->fetch_assoc();$quiz_info=json_decode($jadwal['quiz_info'],true);$token=$jadwal['token'];$kelas=$jadwal['allow_class'];$r_kelas = explode(",",$kelas);$join_kelas = "'".join("','",$r_kelas);$tampilan_jumlah_kelas='';foreach($r_kelas as $x => $value) {$total_peserta = $mysql->get1value("SELECT count(id)+0 jml FROM quiz_member WHERE class='$value' ");	$sudah_ujian = $mysql->get1value("SELECT count(id) jml FROM quiz_done WHERE member_class='$value'  AND schedule_id= $id ");	$tombol_download='';if($sudah_ujian>0) {	$tombol_download='<a href="'.fronturl("get_excel/?schedule_id=".$id."&class=$value").'"><span class="progress-download-xls"><i class="fas fa-download"></i>&nbsp;Excel</span></a>&nbsp;&nbsp;&nbsp;';}$belum_ujian = $total_peserta - $sudah_ujian; $persen = ($sudah_ujian / $total_peserta) * 100;$persen = round($persen,2);//$tombol_download$tampilan_jumlah_kelas .= '			<div class="progress-group">			  <a href="'.backendurl("quiz_schedule/lihat_jawaban/$id?class=$value").'">'.$value.'</a>			  <span class="float-right">'.'<b>'.$sudah_ujian.'</b>/'.$total_peserta.'</span>			  <div class="progress progress-sm">				<div class="progress-bar bg-success" style="width: '.$persen.'%"></div>			  </div>			</div>';}/*JUMLAN PESERTA BERDASARKAN KELAS*/$url_belum_ujian = backendurl("quiz_realtime/?filter=belum_ujian&schedule_id=$id");$url_sedang_ujian = backendurl("quiz_ongoing/?filter=sedang_ujian&schedule_id=$id");$url_pending_ujian = backendurl("quiz_ongoing/?filter=pending&schedule_id=$id");$url_sudah_ujian = backendurl("quiz_ongoing/?filter=sudah_ujian&schedule_id=$id");echo <<<END			            <div class="row">	<div class="col-md-12">			<div class="card card-navy">			<div class="card-header">			  <h3 class="card-title">Hasil $quiz_info[title_id]</h3>			</div>			<!-- /.card-header -->			<div class="card-body">				<table>					<tr><td>Token</td><td>:</td><td>$token</td></tr>					<tr><td>Kode Soal</td><td>:</td><td>$quiz_info[code]</td></tr>					<tr><td>Nama Soal</td><td>:</td><td>$quiz_info[title_id]</td></tr>					<tr><td>Durasi</td><td>:</td><td>$quiz_info[duration] Menit</td></tr>				</table>				<hr/>				$tampilan_jumlah_kelas			</div>			<!-- /.card-body -->		</div>			</div>		</div>END;}if($action=="koreksi_essay" and $_GET['id_quiz_done']!='') {$id_quiz_done=cleanInput($_GET['id_quiz_done'],'int');$data_ujian=data_ujian($id_quiz_done);$show_ujian = show_form_essay($data_ujian);echo $show_ujian;}if($action=="lihat_jawaban" and $id!="" and $_GET['class']!='') {	//$data_ujian=data_ujian($id,$_GET['class']);//$show_ujian = show_ujian($id,$data_ujian);$class= $_GET['class'];$tombol_download='<a href="'.fronturl("get_excel/?schedule_id=".$id."&class=$class").'"><span class="progress-download-xls"><i class="fas fa-download"></i>&nbsp;Download Excel</span></a>&nbsp;&nbsp;&nbsp;';echo <<<END<div class="card card-navy">		<div class="card-header">		  <h3 class="card-title">Jawaban Kelas $class</h3>		  <div class="float-right">$tombol_download</div>		</div>		<!-- /.card-header -->		<div class="card-body">				<table id="data_jawaban" class="table">				<thead>				<tr>				<th>No</th>				<th>Kode</th>				<th>Nama</th>				<th style="width:100px;">Skor PG</th>				<th style="width:100px;">Skor Essay</th>				</tr>				</thead>				</table>		</div>		<!-- /.card-body --></div>END;$url_ajax=backendurl("$modul/data_jawaban?schedule_id=$id&class=$class");$script_js .=<<<END<script>$(document).ready(function(){		// datatables		$('#data_jawaban').DataTable({			'lengthChange': false,			'searching'   : true,			'ordering'    : true,			'info'        : true,			'responsive'  : true,			'processing'  : true,			'serverSide'  : true,			"ajax": {				"url": '$url_ajax',				"type": "POST"			},			"order": [[ 0, 'desc' ]],			 "pageLength": 100,								});});		</script>END;}if($action=="data_jawaban") {		$schedule_id=$_GET['schedule_id'];	$class=$_GET['class'];	$column_order = array('d.member_code','d.member_fullname','d.score','d.score_essay');	$column_search = array('d.member_code','d.member_fullname');	$order = array('m.id' => 'DESC');		if(isset($_POST['order'])) { // here order processing		$order_by = " ORDER BY {$column_order[$_POST['order']['0']['column']]} {$_POST['order']['0']['dir']}";	} 		if ($_POST['length'] != -1 AND $_POST['length']!="") {		$where_limit = "LIMIT {$_POST['start']}, {$_POST['length']}";	}	$i = 0;	$sql_search=array();	foreach ($column_search as $item) { // loop column 				if($_POST['search']['value']) { // if datatable send POST for search						$sql_search[]= " $item LIKE '%{$_POST['search']['value']}%' ";		}		$i++;	}		if(count($sql_search)>0){	$sql_r[]=" ".join(" OR ",$sql_search)." ";	}			$sql="  		SELECT d.id,d.member_code, d.member_fullname,d.score,d.score_essay,d.quiz_id 		FROM quiz_done d 		WHERE d.member_class='$class' AND d.schedule_id=$schedule_id ";	if(count($sql_r)>0){		$sql.=" AND  (".join(" OR ",$sql_r).") ";	}		$result_total = $mysql->query($sql);	$total=$mysql->num_rows($result_total);	$sql .= " $order_by $where_limit";		$result = $mysql->query($sql);		$data = array();		$quiz_id=$mysql->get1value("SELECT quiz_id FROM quiz_schedule WHERE id=".$schedule_id);	$ada_essay=$mysql->get1value("SELECT count(id) FROM quiz_essay WHERE quiz_id=$quiz_id");	$gotopage = $_POST['start']/$_POST['length'];	$no = $_POST['start'];	while($d = $mysql->fetch_assoc($result)) {		$no++;		$row = array();		$row[]=$no;		$row[]=$d['member_code'];		$row[]=$d['member_fullname'];		$row[]=$d['score'];		if($ada_essay>0) {			$row[]='<a class="" href="'.backendurl("$modul/koreksi_essay/$schedule_id?id_quiz_done=".$d['id']."&class=".$class).'">&nbsp;'.($d['score_essay']==""?'0':$d['score_essay']).'</a>';		} else {			$row[]='-';		}		$data[] = $row;	}			$output = array(		"draw" => $_POST['draw'],		"recordsTotal" => $total,		"recordsFiltered" => $total,		"data" => $data	);	die(json_encode($output));}/*//////////////////////////////////////////////////////////*/if($action=="view" or $action==""){$btn_tambah=button_add("$modul/add");//$btn_excel=button_excel("$modul/import_excel");//$btn_excel&nbsp;&nbsp;/*<th>Token</th><th>Judul</th><th>Tanggal</th><th style="width:80px;">Action</th> */ echo <<<END<div class="card card-navy">		<div class="card-header">		  <h3 class="card-title">Jadwal dan Hasil Ujian</h3>		  <div class="float-right">$btn_tambah</div>		</div>		<!-- /.card-header -->		<div class="card-body">				<table id="datalist" class="table">				<thead>				<tr>				<th>Ujian</th>				</tr>				</thead>				</table>		</div>		<!-- /.card-body --></div>END;}if($action=="data") {		$column_order = array('m.id','m.token','m.tanggal','q.title_id');	$column_search = array('m.token','m.tanggal','q.title_id');	$order = array('m.id' => 'DESC');		if(isset($_POST['order'])) { // here order processing		$order_by = " ORDER BY {$column_order[$_POST['order']['0']['column']]} {$_POST['order']['0']['dir']}";	} else {		$order = $order;				$order_by = " ORDER BY m.id DESC ";	}	if ($_POST['length'] != -1 AND $_POST['length']!="") {		$where_limit = "LIMIT {$_POST['start']}, {$_POST['length']}";	}	$i = 0;	$sql_search=array();	foreach ($column_search as $item) { // loop column 				if($_POST['search']['value']) { // if datatable send POST for search						$sql_search[]= " $item LIKE '%{$_POST['search']['value']}%' ";		}		$i++;	}		if(count($sql_search)>0){	$sql_r[]=" ".join(" OR ",$sql_search)." ";	}			$sql="	SELECT m.id,m.token,m.allow_class,m.tanggal,m.tanggal_expired,date_format(m.tanggal,'%d/%m/%Y') exam_date,date_format(m.tanggal,'%H:%i') exam_time,	date_format(m.tanggal_expired,'%d/%m/%Y') exam_date_expired,date_format(m.tanggal_expired,'%H:%i') exam_time_expired,	m.is_late,q.code,q.title_id,q.duration,q.is_random,q.is_random_option,q.kkm,(select count(*) from quiz_detail q WHERE q.quiz_id=m.quiz_id  ) soal, m.modified_date,m.created_date,m.created_by	 FROM $modul m LEFT JOIN quiz_master q ON m.quiz_id=q.id 	WHERE 1=1 	";	/*	if($_SESSION['s_level']==0){		if($is_wali_kelas){			if(count($config_wali_kelas)>0) {				foreach($config_wali_kelas as $kelas) {					$sql_r[]=" FIND_IN_SET('$kelas',m.allow_class) ";				}			}		}		//$sql_r[]=" m.quiz_id IN (SELECT id FROM quiz_master WHERE created_by='".$_SESSION['s_id']."') ";		//$sql_r[]=" m.created_by=".$_SESSION['s_id'];	}	*/	if($_SESSION['s_level']==0){			if($is_wali_kelas){			if(count($config_wali_kelas)>0) {				foreach($config_wali_kelas as $kelas) {					$sql_r[]=" FIND_IN_SET('$kelas',m.allow_class) ";				}						}		}		$sql_r[]=" m.quiz_id IN (SELECT id FROM quiz_master WHERE created_by='".$_SESSION['s_id']."') ";		$sql_r[]=" m.created_by=".$_SESSION['s_id'];		} 	if(count($sql_r)>0){		$sql.=" AND  (".join(" OR ",$sql_r).") ";	}		$result_total = $mysql->query($sql);	$total=$mysql->num_rows($result_total);	$sql .= " $order_by $where_limit";		$result = $mysql->query($sql);		$data = array();		$gotopage = $_POST['start']/$_POST['length'];	$no = $_POST['start'];	while($d = $mysql->fetch_assoc($result)) {		$no++;		/*TANGGAL MULAI DAN EXPIRED*/		$sedang_belangsung = (strtotime($hariini)>=strtotime($d['tanggal']) AND strtotime($hariini)<= strtotime($d['tanggal_expired'])) ?'				<div class="col-md-12">					<div class="alert alert-success"><i class="icon fas fa-exclamation-triangle"></i>Sedang berlangsung</div>                </div>':'';		$tanggal_ujian=tgl_indo_short(date("Y-m-d",strtotime($d['tanggal'])));		$tanggal_expired=tgl_indo_short(date("Y-m-d",strtotime($d['tanggal_expired'])));		$hari_sama=$tanggal_ujian==$tanggal_expired?1:0;		$jadwal_ujian="";		if($hari_sama==1)		{			$jadwal_ujian="			&nbsp;&nbsp;<span class=\"label label-success\">$tanggal_ujian</span>			<span class=\"label label-success\">".date("H:i",strtotime($d['tanggal']))."</span> -			<span class=\"label label-danger\">".date("H:i",strtotime($d['tanggal_expired']))."</span>";		}		else		{			$jadwal_ujian= "&nbsp;&nbsp;<span class=\"label label-success\">$tanggal_ujian ".date("H:i",strtotime($d['tanggal']))."</span><br/>";			$jadwal_ujian.= "&nbsp;&nbsp;<span class=\"label label-danger\">$tanggal_expired ".date("H:i",strtotime($d['tanggal_expired']))."</span>";					}		/*END TANGGAL MULAI DAN EXPIRED*/		$r_allow_class=explode(",",$d['allow_class']);				$allow_class = '<div class="list-class">'.join('</div><div class="list-class">',$r_allow_class).'</div>';		$row = array();		//$row[]=$no;		//$row[]=$d['token'];		//$row[]=$d['code']."<br/>".$d['title_id'];		//$row[]=$jadwal_ujian;				$action_info=btn_info(backendurl("$modul/info/".$d['id']));		$info_url = backendurl("$modul/info/".$d['id']);		$jawaban_url = backendurl("$modul/jawaban/".$d['id']);		$action_edit=btn_edit(backendurl("$modul/edit/".$d['id']));		$ada_ujian_selesai=$mysql->get1value("SELECT count(id) FROM quiz_done WHERE schedule_id=".$d['id']." AND is_done=1 ");		if($ada_ujian_selesai) {			$action_delete=btn_delete(backendurl("$modul/del_confirm/".$d['id']));		} else {			$action_delete=btn_delete(backendurl("$modul/del/".$d['id']));		}		if($level_user==0){			if($id_user!=$d['created_by']){				$action_edit="";				$action_delete="";			}		}		/*		$action_edit='<a href="'.backendurl("$modul/edit/".$d['id']).'"><i class="fas fa-edit" aria-hidden="true"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;';		$action_delete='<a class=""  title="Hapus buku"				data-toggle="modal" 				data-target="#modal-default" 				data-title="Hapus data" 				data-body="Apakah anda yakin ingin menghapus data ini?"				data-btn2=""				data-btn2name=""				data-btn1="'.backendurl("$modul/del/".$d['id']).'"				data-btn1name="Hapus"				>				<i class="fas fa-trash"></i>		</a>';		*/				ob_start();		echo '		<div class="card card-navy collapsed-card">              <div class="card-header">				<div class="row">					'.$sedang_belangsung.'					<div class="col-md-6">						<div class="row">							<div class="col-md-3">								<h3 class="card-label">Token</h3>							</div>							<div class="col-md-9">								<h3 class="card-token">&nbsp;&nbsp;'.$d['token'].'</h3>							</div>							<div class="col-md-3">								<h3 class="card-label">Kode Soal</h3>							</div>							<div class="col-md-9">								<h3 class="card-judul">&nbsp;&nbsp;'.$d['code'].'</h3>							</div>							<div class="col-md-3">								<h3 class="card-label">Nama Soal</h3>							</div>							<div class="col-md-9">								<h3 class="card-judul">&nbsp;&nbsp;'.$d['title_id'].'</h3>							</div>													<div class="col-md-3">								<h3 class="card-label">Jadwal</h3>							</div>							<div class="col-md-9">								<h3 class="card-jadwal">'.$jadwal_ujian.'</h3>							</div>							<div class="col-md-3">								<h3 class="card-label">Kelas</h3>							</div>							<div class="col-md-9">								&nbsp;&nbsp;'.$allow_class.'							</div>						</div>					</div>					<div class="col-md-6">						<div class="row">							<div class="col-md-6">								<a class="btn btn-block btn-warning" href="'.$info_url.'">Monitor Ujian</a>							</div>							<div class="col-md-6">								<a class="btn btn-block btn-primary" href="'.$jawaban_url.'">Lihat jawaban</a>							</div>							</div>						</div>					                </div>                				                <div class="card-tools">                  <button type="button" class="btn btn-tool" data-card-widget="collapse"><i class="fas fa-ellipsis-v"></i>                  </button>                </div>                <!-- /.card-tools -->              </div>              <!-- /.card-header -->              <div class="card-body">                <div class="row">					<div class="col-md-6">										</div>					<div class="col-md-6">										</div>					<div class="col-md-12">					<div class="btn-group btn-group-sm">'.$action_edit.$action_delete.'</div>					</div>                </div>              </div>              <!-- /.card-body -->            </div>            			';$baris=ob_get_clean();					$row[]=$baris;		//$row[]='<div class="btn-group btn-group-sm">'.$action_add.$action_view.$action_info.$action_edit.$action_delete.'</div>';				$data[] = $row;	}			$output = array(		"draw" => $_POST['draw'],		"recordsTotal" => $total,		"recordsFiltered" => $total,		"data" => $data	);	die(json_encode($output));}?>