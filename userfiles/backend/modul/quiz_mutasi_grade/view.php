<?phpif($action=="history") {	$data_siswa = $mysql->fetch_assoc($mysql->query("SELECT * FROM quiz_member WHERE id=".$_GET['id_siswa']));	$nama_siswa = $data_siswa['fullname'];		$q = $mysql->query("SELECT l.class,u.fullname,l.created_date FROM quiz_class_log l LEFT JOIN 	user u ON u.id=l.created_by WHERE l.member_id=".$_GET['id_siswa']." ORDER BY l.created_date");		$tr_history = array();	if($q and $mysql->num_rows($q)>0) {		while($d = $mysql->fetch_assoc($q)) {			$tr_history[]='			<tr>			<td>'.$d['class'].'</td>			<td>'.$d['fullname'].'</td>			<td>'.$d['created_date'].'</td>			</tr>			';		}	}	$history_mutasi_kelas = join("",$tr_history);		$q = $mysql->query("SELECT l.grade,u.fullname,l.created_date FROM quiz_grade_log l LEFT JOIN 	user u ON u.id=l.created_by WHERE l.member_id=".$_GET['id_siswa']." ORDER BY l.created_date");		$tr_grade = array();	if($q and $mysql->num_rows($q)>0) {		while($d = $mysql->fetch_assoc($q)) {			$tr_grade[]='			<tr>			<td>'.$d['grade'].'</td>			<td>'.$d['fullname'].'</td>			<td>'.$d['created_date'].'</td>			</tr>			';		}	}	$history_mutasi_grade = join("",$tr_grade);	echo <<<END		 			<div class="card card-navy">			<div class="card-header">			<h3 class="card-title">Mutasi Kelas $nama_siswa</h3>			</div>			<!-- /.card-header -->			<input type="hidden" name="id" value="$id" />			<div class="card-body">				 <table class="table" id="table-mutasi">					<tr>					<th>Kelas</th>					<th>Oleh</th>					<th>Waktu</th>					</tr>					$history_mutasi_kelas                   </table> 			</div> 			</div>             <!-- /.card -->                        			<div class="card card-navy">              <div class="card-header">                <h3 class="card-title">Mutasi Grade $nama_siswa</h3>              </div>              <!-- /.card-header -->              <!-- form start -->                <div class="card-body">                  <table class="table" id="table-mutasi">					<tr>					<th>Grade</th>					<th>Oleh</th>					<th>Waktu</th>					</tr>					$history_mutasi_grade                   </table>                   </div>                                                         </div>             <!-- /.card -->END;}if($action=="add" OR $action=="edit"){if($action=='edit') {		if($level_user==0) {	  if(!in_array($id,$config_wali_kelas)) {		sweetalert2("danger","Anda tidak berhak",backendurl("$modul"));		die();	  }	}			$q=$mysql->query("	SELECT 		id_user	FROM		quiz_wali_kelas WHERE class='$id'	");	$d=$mysql->assoc($q);		foreach($d as $field => $value) {		$_POST[$field]=$_POST[$field]==''?$value:$_POST[$field];	}}$do_action=backendurl("$modul/".($action=="add"?"save":"update"));$label_action=$action=="add"?"Tambah":"Edit";$option_siswa=$mysql->get_assoc('id','fullname','quiz_member',"fullname"," class='$id' ","","");$option_grade=$mysql->get_assoc('nama','nama','quiz_grade',"nama","","","");$no=1;foreach($option_siswa as $id_siswa => $fullname) {	$_POST['grade['.$id_siswa.']']=$mysql->get1value("SELECT grade FROM quiz_member WHERE id=$id_siswa");	$action_view=btn_eye(backendurl("$modul/history?id_siswa=".$id_siswa));	$form_siswa[]='	<tr>	<td style="width:40px;">'.$no.'</td>	<td>'.$fullname.'</td>	<td>'.$form->element_Select("",'grade['.$id_siswa.']',$option_grade,array('style'=>'width:75px;')).'</td>		<td>'.$action_view.'</td>		</tr>	';	$no++;}$content_form_siswa=join("",$form_siswa);echo <<<END  <div class="card card-navy">              <div class="card-header">                <h3 class="card-title">$label_action Grade $id</h3>              </div>              <!-- /.card-header -->              <!-- form start -->              <form role="form" method="POST" id="form-member"  class="form-member yona-validation" action="$do_action"  novalidate enctype="multipart/form-data">				<input type="hidden" name="id" value="$id" />                <div class="card-body">                  <div class="form-group">                  <table class="table" id="table-mutasi">					<tr>					<th>No</th>					<th>Nama</th>					<th>Grade</th>					<th>Histori</th>					</tr>                    $content_form_siswa                   </table>                   </div>                <div class="card-footer">                   <button type="button" class="btn btn-default" onclick="history.back(-1);">Batal</button>&nbsp;&nbsp;&nbsp;<button type="submit" name="submit" value="1" class="btn btn-primary">Submit</button>                </div>              </form>            </div>            <!-- /.card -->END;}if($action=="view" or $action==""){echo <<<END<div class="card card-navy">		<div class="card-header">		  <h3 class="card-title">Mutasi Grade</h3>		</div>		<!-- /.card-header -->		<div class="card-body">				<table id="datalist" class="table table-bordered table-striped responsive no-wrap">				<thead>				<tr>				<th style="width:40px;">No</th>				<th>Kelas</th>				<th>Jumlah</th>				<th>Wali</th>				<th>Grade</th>				<th style="width:80px;">Action</th>				</tr>				</thead>				</table>		</div>		<!-- /.card-body -->	  </div></div>END;}if($action=="data") {				$sql=" 	SELECT x.class,x.jumlah,k.id_user,u.fullname FROM (		SELECT 			count(m.id) jumlah,m.class		FROM 			quiz_member m		GROUP BY m.class		ORDER BY m.class			) x	LEFT JOIN quiz_wali_kelas k ON k.class=x.class	LEFT JOIN user u ON u.id=k.id_user	";		if($level_user==0) {	 $sql.=" WHERE x.class IN ($config_join_class) ";	}			$result = $mysql->query($sql);		$data = array();			while($d = $mysql->fetch_assoc($result)) {		$no++;		$row = array();				$row[]=$no;		$row[]=$d['class'];		$row[]=$d['jumlah'];		$row[]=$d['fullname'];		$option_class= $mysql->get_assoc("grade","grade","quiz_member","grade"," class='".$d['class']."' ");		$row[]=join(",",$option_class);		//$action_print=btn_print(backendurl("$modul/print/".$d['class']));				$action_edit='<a href="'.backendurl("$modul/edit/".$d['class']).'"><i class="fas fa-edit" aria-hidden="true"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;';		$row[]='<div class="btn-group btn-group-sm">'.$action_edit.'</div>';				$data[] = $row;	}			$output = array(		"draw" => $_POST['draw'],		"recordsTotal" => $total,		"recordsFiltered" => $total,		"data" => $data	);	die(json_encode($output));}?>