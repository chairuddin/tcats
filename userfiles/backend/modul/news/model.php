<?phpif($action=="save"){	if(Form::isValid("{$modul}add",false) and $_POST['form']=="{$modul}add") 	{		$url_empty=array();	$url_noempty="";	${"cat_id"}=cleanInput($_POST["cat_id"]);	${"tanggal"}=cleanInput($_POST["tanggal"]);//input dd/mm/yy	list($dd,$mm,$yy)=explode("/",$tanggal);	$tanggal="$yy-$mm-$dd";	foreach($list_lang as $i =>$v)	{	${"title_$v"}=cleanInput($_POST["title_$v"]);	${"summary_$v"}=allowHtml($_POST["summary_$v"]);	${"content_$v"}=allowHtml($_POST["content_$v"]);	${"url_$v"}=generateUniqueUrl(cleanInput(rtrim(ltrim($_POST["title_$v"])),'url'),"$modul");	if(${"url_$v"}==""){$url_empty[]="url_$v";}	if($url_noempty=="" and ${"url_$v"}!=""){$url_noempty="url_$v";}	}	//jika ada url yang kosong ambil yang pertama tidak kosong	if(count($url_empty)>0)	{		foreach($url_empty as $i =>$v)		{		$$v=$$url_noempty;		}	}		if ($_FILES['filename']['error'] != UPLOAD_ERR_NO_FILE)	{	   $unique_name=uniqid();	   $hasilupload = upload('filename', $large_pic,"", $maxfilesize); 	   if($hasilupload!="")	   {	   	msg_warning(_GAGALADDIMAGE,"error");		header("location:".backendurl("$modul/add"));		exit();	   }	   else	   {	      //ambil informasi basename dan extension            $temp = explode(".", $_FILES['filename']['name']);            $extension = $temp[count($temp) - 1];            $basename = '';            for ($i = 0; $i < count($temp) - 1; $i++) {                $basename .= $temp[$i];            }		$modifiedfilename = "$basename-$unique_name.$extension";				//create thumbnail		$hasilresize = resize("$large_pic/".$_FILES['filename']['name'], "$small_pic/$modifiedfilename", 'l', $thumb_width);		if ($hasilresize!="") {		msg_warning(_GAGALADDTHUMBNAIL,"error");		header("location:".backendurl("$modul/add"));		exit();		}		//resize		 list($filewidth, $fileheight, $filetype, $fileattr) = getimagesize("$large_pic/" . $_FILES['filename']['name']);		 		 if ($filewidth > $max_width) {                //rename sambil resize gambar asli sesuai yang diizinkan                $hasilresize = resize("$large_pic/" . $_FILES['filename']['name'], "$large_pic/$modifiedfilename", 'w', $max_width);                if ($hasilresize !="") {					msg_warning(_GAGALRESIZE,"error");					header("location:".backendurl("$modul/add"));					exit();                }                //del gambar asli                unlink("$large_pic/" . $_FILES['filename']['name']);            } else {                rename("$large_pic/" . $_FILES['filename']['name'], "$large_pic/$modifiedfilename");            }	   }	}			$sql="INSERT INTO $modul (";	$sql.="id,cat_id,publish";	foreach($list_lang as $i =>$v)	{	$sql.=",title_$v";	$sql.=",summary_$v";	$sql.=",content_$v";	$sql.=",url_$v";	}	$sql.=",tanggal";	if($modifiedfilename=="")$sql.=",thumbnail";		$sql.=")";		$sql.=" values (";	$sql.="null,'".${"cat_id"}."',1";	foreach($list_lang as $i =>$v)	{	$sql.=",'".${"title_$v"}."'";	$sql.=",'".${"summary_$v"}."'";	$sql.=",'".${"content_$v"}."'";	$sql.=",'".${"url_$v"}."'";	}	$sql.=",'$tanggal'";		if($modifiedfilename=="")$sql.=",'".$modifiedfilename."'";		$sql.=")";		$r=$mysql->query($sql);	if($r)	{	msg_warning(_BERHASILTAMBAH,"success");	Form::clearValues("{$modul}add"); 	header("location:".backendurl("$modul/view"));	exit();	}		}	else	{	msg_warning(_GAGALADD,"error");	header("location:".backendurl("$modul/add"));	exit();	}	}if($action=="update"){	$id=cleanInput($_POST['id'],'numeric');	$url_empty=array();	$url_noempty="";	${"cat_id"}=cleanInput($_POST["cat_id"]);	${"tanggal"}=cleanInput($_POST["tanggal"]);//input dd/mm/yy	list($dd,$mm,$yy)=explode("/",$tanggal);	$tanggal="$yy-$mm-$dd";	foreach($list_lang as $i =>$v)	{	${"title_$v"}=cleanInput($_POST["title_$v"]);	${"summary_$v"}=allowHtml($_POST["summary_$v"]);	${"content_$v"}=allowHtml($_POST["content_$v"]);	${"url_$v"}=generateUniqueUrl(cleanInput(rtrim(ltrim($_POST["title_$v"])),'url'),$modul,$id);	if(${"url_$v"}==""){$url_empty[]="url_$v";}	if($url_noempty=="" and ${"url_$v"}!=""){$url_noempty="url_$v";}	}	//jika ada url yang kosong ambil yang pertama tidak kosong	if(count($url_empty)>0)	{		foreach($url_empty as $i =>$v)		{		$$v=$$url_noempty;		}	}	if(!Form::isValid("update{$modul}",false) or $_POST['form']!="update{$modul}") 	{		redirecto(_GAGALUPDATE,"error","edit/$id");	}	$modifiedfilename="";	if ($_FILES['filename']['error'] != UPLOAD_ERR_NO_FILE)	{	   	   $hasilupload = upload('filename', $large_pic,"", $maxfilesize); 	   if($hasilupload!="")	   {		msg_warning(_GAGALADDIMAGE,"error");		header("location:".backendurl("$modul/edit/$id"));		exit();	   }	   else	   {	      //ambil informasi basename dan extension            $temp = explode(".", $_FILES['filename']['name']);            $extension = $temp[count($temp) - 1];            $basename = '';            for ($i = 0; $i < count($temp) - 1; $i++) {                $basename .= $temp[$i];            }		$unique_name=uniqid();			$modifiedfilename = "$basename-$unique_name.$extension";				//create thumbnail		$hasilresize = resize("$large_pic/".$_FILES['filename']['name'], "$small_pic/$modifiedfilename", 'l', $thumb_width);		if ($hasilresize!="") {		msg_warning(_GAGALADDTHUMBNAIL,"error");		header("location:".backendurl("$modul/edit/$id"));		exit();		}		//resize		 list($filewidth, $fileheight, $filetype, $fileattr) = getimagesize("$large_pic/" . $_FILES['filename']['name']);		 		 if ($filewidth > $max_width) {                //rename sambil resize gambar asli sesuai yang diizinkan                $hasilresize = resize("$large_pic/" . $_FILES['filename']['name'], "$large_pic/$modifiedfilename", 'w', $max_width);                if ($hasilresize !="") {					msg_warning(_GAGALRESIZE,"error");					header("location:".backendurl("$modul/edit"));					exit();                }				unlink("$large_pic/" . $_FILES['filename']['name']);                            } else {                rename("$large_pic/" . $_FILES['filename']['name'], "$large_pic/$modifiedfilename");            }				$r=$mysql->query("SELECT thumbnail from $modul WHERE id='$id'");		list($oldfilename)=$mysql->row($r);		//del gambar asli		if(file_exists("$large_pic/$oldfilename"))unlink("$large_pic/$oldfilename");		if(file_exists("$small_pic/$oldfilename"))unlink("$small_pic/$oldfilename");	  }	}		$sql_r=array();	$sql="	UPDATE $modul SET ";	$sql_r[]="cat_id='".${"cat_id"}."'";	$sql_r[]="tanggal='".$tanggal."'";	foreach($list_lang as $i =>$v)	{	$sql_r[]="title_$v='".${"title_$v"}."'";	$sql_r[]="summary_$v='".${"summary_$v"}."'";	$sql_r[]="content_$v='".${"content_$v"}."'";	$sql_r[]="url_$v='".${"url_$v"}."'";	}		if($modifiedfilename!="")$sql_r[]="thumbnail='".$modifiedfilename."'";	$sql.=join(",",$sql_r);	$sql.="	WHERE id=$id";		$r=$mysql->query($sql);	if($r)	{	Form::clearValues("update{$modul}"); 	msg_warning(_BERHASILUPDATE,"success");	header("location:".backendurl("$modul/view"));	exit();	}	else	{	msg_warning(_GAGALUPDATE,"error");	header("location:".backendurl("$modul/edit/$id"));	exit();	}	}if($action=="del"){$id=cleanInput($id,'numeric');$r=$mysql->query("SELECT thumbnail from $modul WHERE id='$id'");list($oldfilename)=$mysql->row($r);//del gambar if(file_exists("$large_pic/$oldfilename")){unlink("$large_pic/$oldfilename");}if(file_exists("$small_pic/$oldfilename")){unlink("$small_pic/$oldfilename");}$sql="DELETE FROM $modul WHERE id='$id'";$r=$mysql->query($sql);if($r){		Form::clearValues("update{$modul}");	msg_warning(_BERHASILHAPUS,"success");	header("location:".backendurl("$modul/view"));	exit();}else{	msg_warning(_GAGALHAPUS,"error");	header("location:".backendurl("$modul/view"));	exit();}}if($action=="sortitem"){$list=$_POST['list'];for($i=1;$i<=count($list);$i++){$idlist=cleanInput($list[$i-1],'numeric');$q=$mysql->query("UPDATE $modul set urutan=$i WHERE id='$idlist'");}exit();}?>