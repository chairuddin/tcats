<?php$hariini=date("Y-m-d H:i:s");if($action=="custom_score") {		if($_GET['custom_score']==2) {				if($_GET['sub_action']=='edit'){				$q=$mysql->query("SELECT poin_A,poin_B,poin_C,poin_D,poin_E,poin_F,poin_G,poin_H,poin_I,poin_J FROM quiz_master WHERE id=".$_GET['sub_id']);				$data=$mysql->fetch_assoc($q);								foreach($pilihan_ganda as $pil_gan) {			      $default_score[$pil_gan]=$data['poin_'.$pil_gan];						}						} else {			$default_score = array(			'A'=>100,			'B'=>90,			'C'=>80,			'D'=>70,			'E'=>60,			'F'=>50,			'G'=>40,			'H'=>30,			'I'=>20,			'J'=>10,			);		}		echo '<div style="border:1px solid #cecece; padding:15px;">';		echo '<div class="row" style="">';		echo '<div class="col-md-12"><p>Isian dalam bentuk persen(%) </p></div>';		foreach($pilihan_ganda as $pil_gan) {			$form_poin=$form->element_Textbox("Poin $pil_gan","poin_{$pil_gan}",array('autocomplete'=>'off','value'=>$default_score[$pil_gan]));			echo '<div class="col-md-1 col-sm-4 col-xs-4">'.$form_poin.'</div>';		}		echo '</div>';		echo '</div>';	} else {		}	die();}if($action=="add" OR $action=="edit"){$list_grade=$mysql->get_assoc('nama','nama','quiz_grade','nama');if($action=='edit') {	$q=$mysql->query("	SELECT 		*	FROM		quiz_master WHERE id=$id	");	$d=$mysql->assoc($q);	foreach($d as $field => $value) {		$_POST[$field]=$_POST[$field]==''?$value:$_POST[$field];	}}//default value add$_POST['custom_score']=$_POST['custom_score']==''?0:$_POST['custom_score'];$_POST['score']=$_POST['score']==''?100:$_POST['score'];$_POST['score_essay']=$_POST['score_essay']==''?100:$_POST['score_essay'];$_POST['is_random']=strlen($_POST['is_random'])<=0?100:$_POST['is_random'];$_POST['is_random_option']=strlen($_POST['is_random_option'])<=0?1:$_POST['is_random'];$_POST['duration']=$_POST['duration']==''?90:$_POST['duration'];$_POST['kkm']=$_POST['kkm']==''?70:$_POST['kkm'];//end default value$do_action=backendurl("$modul/".($action=="add"?"save":"update"));$label_action=$action=="add"?"Tambah":"Edit";//$form_grade= $form->element_Select("Pilih Grade","grade",$list_grade );$form_code=$form->element_Textbox("Kode Soal","code");$form_title_id=$form->element_Textbox("Nama Soal","title_id");$form_duration=$form->element_Textbox("Durasi (menit)","duration");//$form_model_skor= $form->element_Select("Model Skor PG","custom_score",array("0"=>"Otomatis","2"=>"Manual"),array("onchange"=>"model_skor();") );$form_score_pg=$form->element_Textbox("Skor PG(maksimal)","score");$form_score_essay=$form->element_Textbox("Skor Essay(maksimal)","score_essay");$form_kkm=$form->element_Textbox("KKM","kkm");$form_is_random= $form->element_Select("Acak Soal","is_random",array("1"=>"Ya","0"=>"Tidak") );$form_is_random_option= $form->element_Select("Acak Pilihan Jawaban (A,B,C,D,E)","is_random_option",array("1"=>"Ya","0"=>"Tidak") );/*                <div class="form-group">                    $form_grade                                   </div>  */echo <<<END  <div class="card card-navy">              <div class="card-header">                <h3 class="card-title">$label_action Master Soal</h3>              </div>              <!-- /.card-header -->              <!-- form start -->              <form role="form" method="POST" id="form-member"  class="form-member yona-validation" action="$do_action"  novalidate enctype="multipart/form-data">				<input type="hidden" name="id" value="$id" />                <div class="card-body">                  <div class="form-group">                    $form_code                                   </div>                  <div class="form-group">                    $form_title_id                                  </div>                  <div class="form-group">                    $form_duration                                      </div>                 <div class="form-group">                    $form_model_skor                                      </div>                  <div class="form-group" >					  <div  id="form_custom_score">					  </div>                  </div>                  <div class="form-group">                    $form_score_pg                                      </div>                  <div class="form-group">                    $form_score_essay                                   </div>                  <div class="form-group">                    $form_kkm                                     </div>                  <div class="form-group">                    $form_is_random                                     </div>                  <div class="form-group">                    $form_is_random_option                                     </div>                <div class="card-footer">                   <button type="button" class="btn btn-default" onclick="history.back(-1);">Batal</button>&nbsp;&nbsp;&nbsp;<button type="submit" name="submit" value="1" class="btn btn-primary">Submit</button>                </div>              </form>            </div>            <!-- /.card -->END;$url_custom_score=backendurl("$modul/custom_score?&custom_score=");if($action=="edit" AND $_POST['custom_score']==2) {	$url_custom_score=backendurl("$modul/custom_score?&sub_action=edit&sub_id=$id&custom_score=");		/*buat load ajax untuk custom score manual*/	$load_js_custom_score=<<<END	   var jqxhr = $.get( "{$url_custom_score}2}", function(data) {		document.getElementById("form_custom_score").innerHTML=data;	   }).done(function() {		 	  }).fail(function() {			Swal.fire({			icon: 'error',			title: 'Gagal request data',			text: 'Silahkan refresh halaman',			});	  });END;}$script_js .=<<<END<script>function model_skor() {	custom_score = document.getElementById("custom_score").value;   var jqxhr = $.get( "$url_custom_score"+custom_score, function(data) {	document.getElementById("form_custom_score").innerHTML=data;   }).done(function() {       }).fail(function() {		Swal.fire({		icon: 'error',		title: 'Gagal request data',		text: 'Silahkan refresh halaman',		});  });}$(document).ready(function(){$load_js_custom_score});</script>END;}if($action=="view" or $action==""){$btn_tambah=button_add("$modul/add");//$btn_excel=button_excel("$modul/import_excel");//$btn_excel&nbsp;&nbsp;echo <<<END<div class="card card-navy">		<div class="card-header">		  <h3 class="card-title">$form_title</h3>		  <div class="float-right">$btn_tambah</div>		</div>		<!-- /.card-header -->		<div class="card-body">				<table id="datalist" class="table table-bordered table-striped responsive no-wrap">				<thead>				<tr>				<th style="width:40px;">No</th>				<th>Judul</th>				<th>KKM</th>				<th>Durasi</th>				<th style="width:80px;">Action</th>				</tr>				</thead>				</table>		</div>		<!-- /.card-body -->	  </div></div>END;}if($action=="data") {		$column_order = array('m.id','m.code','m.title_id','m.kkm','m.duration');	$column_search = array('m.code','m.grade','m.title_id','m.kkm','m.duration');	$order = array('m.id' => 'DESC');		if(isset($_POST['order'])) { // here order processing		$order_by = " ORDER BY {$column_order[$_POST['order']['0']['column']]} {$_POST['order']['0']['dir']}";	} else {		$order = $order;				$order_by = " ORDER BY m.code DESC ";	}	if ($_POST['length'] != -1 AND $_POST['length']!="") {		$where_limit = "LIMIT {$_POST['start']}, {$_POST['length']}";	}	$i = 0;	$sql_search=array();	foreach ($column_search as $item) { // loop column 				if($_POST['search']['value']) { // if datatable send POST for search						$sql_search[]= " $item LIKE '%{$_POST['search']['value']}%' ";		}		$i++;	}		if(count($sql_search)>0){	$sql_r[]=" ".join(" OR ",$sql_search)." ";	}	/*	<th>Kode</th>				<th>Judul</th>				<th>Durasi</th>				<th>KKM</th>				<th>Acak</th>				<th>Soal</th>				*/ 	/*	$sql=" 	SELECT 			id,		code,		title_id,		kkm,		duration	FROM 		quiz_master		";		$sql.=" WHERE 1=1 ";	* */		$sql="SELECT m.*,	(select count(id) from quiz_detail q WHERE q.quiz_id=m.id  ) multiple,	(select count(id) from quiz_essay q WHERE q.quiz_id=m.id  ) essay,	u.username,('$hariini' <= DATE_ADD(created_date, INTERVAL 5 MINUTE)) soal_baru 	FROM 		quiz_master m 		LEFT JOIN user u ON m.created_by=u.id WHERE 1=1 ";	if($_SESSION['s_level']==0){	$sql_r[]="m.created_by='".$_SESSION['s_id']."'";	//$sql_r[]="m.grade IN ($config_join_grade) ";	}	if(count($sql_r)>0){		$sql.=" AND  (".join(" OR ",$sql_r).") ";	}		$result_total = $mysql->query($sql);	$total=$mysql->num_rows($result_total);	$sql .= " $order_by $where_limit";		$result = $mysql->query($sql);		$data = array();		$gotopage = $_POST['start']/$_POST['length'];	$no = $_POST['start'];	while($d = $mysql->fetch_assoc($result)) {		$no++;		$row = array();				/*		$row[]=$d['code'];		$row[]=$d['grade']." ".$d['title_id'];		$row[]=$d['kkm'];		$row[]=$d['duration'];		$row[]=$d['multiple']."|".$d['essay'];		$row[]=$d['custom_score']==0?"A":"M";		*/		$row[]=$no;		$row[]='<b>'.$d['code'].'</b><br/>'.$d['title_id'];		$row[]=$d['kkm'];		$row[]=$d['duration'];		$action_add=btn_add(backendurl("quiz_detail/view?id_soal=".$d['id']));		$action_edit=btn_edit(backendurl("$modul/edit/".$d['id']));		if($id_user==$d['created_by'] or $_SESSION['s_level']>0) {			$action_delete=btn_delete(backendurl("$modul/del/".$d['id']));		} else {			$action_delete='';		}		/*		$action_edit='<a href="'.backendurl("$modul/edit/".$d['id']).'"><i class="fas fa-edit" aria-hidden="true"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;';		$action_delete='<a class=""  title="Hapus buku"				data-toggle="modal" 				data-target="#modal-default" 				data-title="Hapus data" 				data-body="Apakah anda yakin ingin menghapus data ini?"				data-btn2=""				data-btn2name=""				data-btn1="'.backendurl("$modul/del/".$d['id']).'"				data-btn1name="Hapus"				>				<i class="fas fa-trash"></i>		</a>';		*/		$row[]='<div class="btn-group btn-group-sm">'.$action_add.$action_view.$action_edit.$action_delete.'</div>';				$data[] = $row;	}			$output = array(		"draw" => $_POST['draw'],		"recordsTotal" => $total,		"recordsFiltered" => $total,		"data" => $data	);	die(json_encode($output));}?>