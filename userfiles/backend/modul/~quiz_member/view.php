<?php//if($action==""){$col_back="&nbsp;";	}$hariini_long=date("Y-m-d H:i:s");if($_GET['download_template']==1){	// output headers so that the file is downloaded rather than displayed	header('Content-Type: text/csv; charset=utf-8');	header('Content-Disposition: attachment; filename=Template_Import_Peserta.csv');	// create a file pointer connected to the output stream	$output = fopen('php://output', 'w');	// output the column headings	fputcsv($output, array('Kode Login', 'Nama Peserta', 'Kelas'));	fputcsv($output, array('TKJ-1001', 'Romli', 'TKJ'));		exit();	}if($_GET['download_template']==2){error_reporting(E_ALL);ini_set('display_errors', FALSE);ini_set('display_startup_errors', FALSE);date_default_timezone_set('Asia/Jakarta');// Create new PHPExcel object$objPHPExcel = new PHPExcel();// Set document properties$objPHPExcel->getProperties()->setCreator("websuka.com") ->setLastModifiedBy("websuka.com") ->setTitle("Ujian Online Berbasis Komputer") ->setSubject("Ujian Online Berbasis Komputer") ->setDescription("Ujian Online Berbasis Komputer") ->setKeywords("Ujian Online Berbasis Komputer") ->setCategory("Ujian Online Berbasis KOmputer");$objPHPExcel->setActiveSheetIndex(0)            ->setCellValue('A1',"Kode Login")            ->setCellValue('B1',"Nama Peserta")            ->setCellValue('C1',"Kelas");	/*	$q=$mysql->query("SELECT * FROM user WHERE level<=1 ");	$no=2;	while($d=$mysql->assoc($q))	{	$objPHPExcel->setActiveSheetIndex(0)			->setCellValue('A'.$no,$d['username'])			->setCellValue('B'.$no,$d['password'])			->setCellValue('C'.$no,$d['fullname']);	$no++;			}      	*/      		$no=2;	$objPHPExcel->setActiveSheetIndex(0)			->setCellValue('A'.$no,"TKJ-1001")			->setCellValue('B'.$no,"Romli")			->setCellValue('C'.$no,"TKJ");			$filename="Template Login Peserta";$sheet_title="Data login peserta";// Rename worksheet$objPHPExcel->getActiveSheet()->setTitle($sheet_title);// Set active sheet index to the first sheet, so Excel opens this as the first sheet$objPHPExcel->setActiveSheetIndex(0);// Redirect output to a clientâ€™s web browser (Excel5)header('Content-Type: application/vnd.ms-excel');header('Content-Disposition: attachment;filename="'.$filename.'.xls"');header('Cache-Control: max-age=0');// If you're serving to IE 9, then the following may be neededheader('Cache-Control: max-age=1');// If you're serving to IE over SSL, then the following may be neededheader ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the pastheader ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modifiedheader ('Cache-Control: cache, must-revalidate'); // HTTP/1.1header ('Pragma: public'); // HTTP/1.0$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');$objWriter->save('php://output');exit;}if($action=="download_csv"){	// output headers so that the file is downloaded rather than displayed	header('Content-Type: text/csv; charset=utf-8');	header('Content-Disposition: attachment; filename="Download_Peserta '.$hariini_long.'.csv"');	// create a file pointer connected to the output stream	$output = fopen('php://output', 'w');	// output the column headings	fputcsv($output, array('Kode Login', 'Nama Peserta', 'Kelas'));	$q=$mysql->query("SELECT username,fullname,class FROM quiz_member ORDER BY username");	if($q and $mysql->numrows($q)>0){		while($d=$mysql->assoc($q)){		fputcsv($output, array($d['username'],$d['fullname'],$d['class']));		}	}		exit();	}if($action=="upload_csv"){$form = new Form("uploadmember");$form->configure(array(	"prevent" => array("bootstrap", "jQuery", "focus"),	"action" =>backendurl("$modul/uploadmember"),	"enctype" =>"multipart/form-data"));$form->addElement(new Element_Hidden("form", "uploadmember"));$form->addElement(new Element_HTML('<legend>'._UPLOADMEMBER.'</legend>'));$form->addElement(new Element_HTML('<div class="control-group"><label for="foto_add" class="control-label"></label><div class="controls">Silahkan download template dengan format .csv terlebih dahulu '.button_download("quiz_member?download_template=1").' <br/>Lakukan pengisian data di template tersebut. <br/>Selanjutnya di upload kembali file csv dibawah ini.<br/></div></div>'));$form->addElement(new Element_HTML('<div class="control-group"><label for="foto_add" class="control-label"></label><div class="controls">'._UPLOAD.'<input type="file"  id="member_csv" required="required" name="member_csv" accept="csv/*" class="thumbnail_product"><br/><br/><input type="checkbox" name="replace" value="1" /> Apakah data member lama akan dihapus ganti dengan yang baru?</div></div>'));$form->addElement(new Element_Button(_SIMPAN));$form->addElement(new Element_Button(_BATAL, "button", array(	"onclick" => "history.go(-1);")));$form->render();}if($action=="download_xls"){$form = new Form("uploadmemberxls");$form->configure(array(	"prevent" => array("bootstrap", "jQuery", "focus"),	"action" =>backendurl("$modul/uploadmember_xls"),	"enctype" =>"multipart/form-data"));$form->addElement(new Element_Hidden("form", "uploadmemberxls"));$form->addElement(new Element_HTML('<legend>'._UPLOADMEMBERXLS.'</legend>'));$form->addElement(new Element_HTML('<div class="control-group"><label for="foto_add" class="control-label"></label><div class="controls">Silahkan download template dengan format .xls terlebih dahulu <a href="'.backendurl('quiz_member?download_template=2').'" class="btn btn-download">Download Template(.xls)</a> <br/>Lakukan pengisian data di template tersebut. <br/>Selanjutnya di upload kembali file xls dibawah ini.<br/></div></div>'));$form->addElement(new Element_HTML('<div class="control-group"><label for="foto_add" class="control-label"></label><div class="controls">'._UPLOADXLS.'<input type="file"  id="member_csv" required="required" name="filename" accept="xls/*" class="thumbnail_product"><br/><br/><input type="checkbox" name="replace" value="1" /> Apakah data member lama akan dihapus ganti dengan yang baru?</div></div>'));$form->addElement(new Element_Button(_SIMPAN));$form->addElement(new Element_Button(_BATAL, "button", array(	"onclick" => "history.go(-1);")));$form->render();}if($action=="edit"){	if($_SESSION['s_level']<=0){redirecto(_TIDAKBERHAK,"error","view");}$r=$mysql->query("SELECT * from quiz_member where id=$id");$d=$mysql->assoc($r);if($_SESSION['s_level']<$d['level']){redirecto(_TIDAKBERHAK,"error","view");}$form = new Form("updateuser");$form->configure(array(	"prevent" => array("bootstrap", "jQuery", "focus"),	"action" =>backendurl("quiz_member/update") ));$options_status = array("1"=>_AKTIF,"0"=>_TIDAKAKTIF);$form->addElement(new Element_HTML('<legend>'._EDITUSER.'</legend>'));$form->addElement(new Element_Hidden("form", "updateuser"));$form->addElement(new Element_Hidden("id",$d['id']));$form->addElement(new Element_Textbox(_KODELOGIN, "username", array("required" => 1,"value"=>$d['username'])));//$form->addElement(new Element_Password(_PASSWORD, "password", array("placeholder" =>"******")));//$form->addElement(new Element_Password(_RETYPEPASSWORD, "password2", array("placeholder" =>"*******")));$form->addElement(new Element_Textbox(_CLASS, "class", array("value"=>$d['class'])));$form->addElement(new Element_Textbox(_NAMALENGKAP, "fullname", array("required" => 1,"value"=>$d['fullname'])));//$form->addElement(new Element_Select(_LEVEL, "level", $options_level,array("value"=>$d['level'])));$form->addElement(new Element_Select(_STATUS, "status", $options_status,array("value"=>$d['status'])));$form->addElement(new Element_Button(_SIMPAN));$form->addElement(new Element_Button(_BATAL, "button", array(	"onclick" => "history.go(-1);")));$form->render();}if($action=="add"){if($_SESSION['s_level']<=0){redirecto(_TIDAKBERHAK,"error","view");}$form = new Form("reguser");$form->configure(array(	"prevent" => array("bootstrap", "jQuery", "focus"),	"action" =>backendurl("quiz_member/save") ));$options_status = array("1"=>_AKTIF,"0"=>_TIDAKAKTIF);$form->addElement(new Element_HTML('<legend>'._TAMBAHUSER.'</legend>'));$form->addElement(new Element_Hidden("form", "reguser"));$form->addElement(new Element_Textbox(_KODELOGIN, "username", array("required" => 1,"value"=>$d['username'])));//$form->addElement(new Element_Password(_PASSWORD, "password", array("placeholder" =>"******")));//$form->addElement(new Element_Password(_RETYPEPASSWORD, "password2", array("placeholder" =>"*******")));$form->addElement(new Element_Textbox(_CLASS, "class", array("value"=>$d['class'])));$form->addElement(new Element_Textbox(_NAMALENGKAP, "fullname", array("required" => 1,"value"=>$d['fullname'])));//$form->addElement(new Element_Select(_LEVEL, "level", $options_level,array("value"=>$d['level'])));$form->addElement(new Element_Select(_STATUS, "status", $options_status,array("value"=>$d['status'])));$form->addElement(new Element_Button(_SIMPAN));$form->addElement(new Element_Button(_BATAL, "button", array(	"onclick" => "history.go(-1);")));$form->render();}if($action=="" or $action=="search" or $action=="view"){$form_search=form_search($keyword);}if($action=="addphoto"){$pathfilemanager=$config['tinyurl']."/userfiles/backend/modul/quiz_member/filemanager/dialog.php?type=1&fldr=$modul";if($_SESSION['s_level']>0)	{	echo <<<END	<h5>Tipe gambar harus (*.jpg)</h5>	<h5>Nama gambar harus menggunakan kode login ("Kode Login.jpg")</h5>	<iframe width="100%" height="550" frameborder="0" src="$pathfilemanager"> </iframe>END;	}}if($action=="view" or $action=="" or $action=="search"){Form::clearValues("updateuser");	Form::clearValues("reguser");		if($_SESSION['s_level']>0){$col_tambah=button_add("quiz_member/add");//$col_tambah.="&nbsp;&nbsp;".button_upload("quiz_member/upload_xls");$col_tambah.="&nbsp;&nbsp; <a href=\"".backendurl("quiz_member/download_xls")."\" class=\"btn btn-upload\">Upload Member XLS</a>";$col_tambah.="&nbsp;&nbsp;<a class=\"btn btn-upload\" href=\"".backendurl("quiz_member/addphoto")."\">Tambah Foto</a>";//$col_tambah.="&nbsp;&nbsp;<a class=\"btn btn-download\" href=\"".backendurl("quiz_member/download_csv")."\">Download CSV</a>";}if($_SESSION['s_level']>1){$col_tambah.="<br/><br/><a class=\"btn btn-upload\" href=\"#\" onclick=\"$('.upload_member').show();\">Restore Member(*.gz)</a>";$col_tambah.="&nbsp;&nbsp;<a class=\"btn btn-download\" onclick=\"document.getElementById('form_list_member').submit();\">Backup Member(*.gz)</a>";$col_tambah.="&nbsp;&nbsp;<span class=\"upload_member\" style=\"display:none;\"><form method=\"post\" enctype=\"multipart/form-data\" action=\"".backendurl("$modul/upload")."\">File Jadwal (*.gz)<input type=\"file\" accept=\"gz/*\" name=\"filename\" required=\"required\"><button type=\"submit\" class=\"btn btn-primary\" name=\"proses_upload\" value=\"1\" />Submit Member</button></form></span><form method='post' id='form_list_member' name='form_list_member' action='".backendurl("$modul/download")."'><input type='hidden' name='backup_all' value='1' /></form>";}$sql="SELECT id,username,fullname,if(status=1,'"._AKTIF."','"._TIDAKAKTIF."') status,class FROM quiz_member q ";if($action=="search"){$sql.=" WHERE username like '%$keyword%' or fullname like '%$keyword%' or class like '%$keyword%'";} $r=$mysql->query($sql);$total_records = $mysql->numrows($r);$start = $screen * $max_page_list;$pages = ceil($total_records/$max_page_list);if ($pages>1) $col_pagination=pagination($screen);$sql.="  order by $sort_by $sort_order  LIMIT $start, $max_page_list";$r=$mysql->query($sql);echo "<table id='DataTables_Table_3_wrapper' class='table table-hover table-nomargin table-bordered '>";echo "<thead><tr><th>No</th><th>".orderBy("username",_EMAILLOGIN,$sort_order,$sort_by)."</th><th>".orderBy("fullname",_NAMALENGKAP,$sort_order,$sort_by)."</th><th>".orderBy("class",_CLASS,$sort_order,$sort_by)."</th><th>Sudah Ujian</th><th>".orderBy("status",_STATUS,$sort_order,$sort_by)."</th>";if($_SESSION['s_level']>0){echo "<th>Action</th>";}echo "</tr></thead>";$no=($start+1);echo '<tbody>';while($d=$mysql->assoc($r)){	$pathfoto=$config['userfiles']."/quiz_member/source/".$d['username'].".jpg";$urlfoto=$config['urlfiles']."/quiz_member/source/".$d['username'].".jpg";if(file_exists($pathfoto)){$foto="<div class='fotoserta'><img width='50px' src='$urlfoto' /></div>";	}else{	$pathfoto=$config['userfiles']."/quiz_member/source/".$d['username'].".jpeg";	$urlfoto=$config['urlfiles']."/quiz_member/source/".$d['username'].".jpeg";	if(file_exists($pathfoto)){	$foto="<div class='fotoserta'><img width='50px' src='$urlfoto' /></div>";		}else{	$foto="";	}}	$ikut_ujian=$mysql->get1value("select count(id) FROM quiz_done WHERE member_id=".$d['id']);	echo "<tr><td>$no</td><td>".$d['username']."</td><td>".$d['fullname']."$foto</td><td>".$d['class']."</td><td>".$ikut_ujian."</td><td>".$d['status']."</td>";if($_SESSION['s_level']>0){$ar_action=array("edit"=>$d['id'],"del"=>$d['id']);echo "<td>".button_action($ar_action)."</td>";}$no++;echo "</tr>";}echo "</tbody>";echo "</table>";if($action=="regfinish"){echo "Berhasil daftar silahkan cek email anda";}}?>