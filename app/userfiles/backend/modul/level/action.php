<?php/*Catatan pakai yona-validation:Form :	Form menggunakan class yona-validation	Tombol submit name=submitVar  : nama element harus sama dengan var   * */$hari_ini=date("Y-m-d H:i:s");$admin_id=$_SESSION['s_id'];		$validation->set_validation(array('var'=>'nama','label'=>'Level'))->minlength(3)->required();$validation->generate_js_validation();        if($action=="save" or $action=="update") {		$id=$_POST['id'];		if($validation->valid()){		$r_post=array(		'nama'		);				$sql_r = array();				if($action=="save") {			$sql_r[]="created_by='$admin_id'";			$sql_r[]="created_date='$hari_ini'";		}				if($action=="update") {			$sql_r[]="modified_by='$admin_id'";			$sql_r[]="modified_date='$hari_ini'";		}						foreach($r_post as $i => $v) {			$post=cleanInput($_POST[$v]);			$sql_r[]="$v = '$post'";		}				if($action=="save") {			$sql=" INSERT INTO level SET ".join(" ,",$sql_r);			$q=$mysql->query($sql);			$last_id=$mysql->insert_id();		}				if($action=="update") {			$sql=" UPDATE level SET ".join(" ,",$sql_r)." WHERE id=$id ";			$q=$mysql->query($sql);		}						} else {		sweetalert2($type="warning",$msg=($action=="update"?"Update":"Tambah")." jabatan gagal, data tidak valid",backendurl("$modul"));	}		if($q){		sweetalert2($type="success",$msg=($action=="update"?"Update":"Tambah")." jabatan berhasil",backendurl("$modul"));	} else {		sweetalert2($type="warning",$msg=($action=="update"?"Update":"Tambah")." jabatan gagal",backendurl("$modul"));	}	}if($action=="del"){$id=cleanInput($id,'numeric');/*$r=$mysql->query("SELECT thumbnail,ebook from buku WHERE id='$id'");list($file_thumbnail,$file_ebook)=$mysql->row($r);//del gambar if(file_exists("$path_thumbnail/$file_thumbnail")){	unlink("$path_thumbnail/$file_thumbnail");}//del pdf if(file_exists("$path_thumbnail/$file_ebook")){	unlink("$path_thumbnail/$file_ebook");}*/ //update log	$valid=true;	$mysql->autocommit(false);	$q1=$mysql->query("UPDATE level SET deleted_by=$admin_id,deleted_date='$hari_ini' WHERE id=$id ");	if(!$q1){ $valid=false;}			$q2=$mysql->query("INSERT INTO level SELECT * FROM level WHERE id=$id ");	$sql="DELETE FROM level WHERE id='$id'";	$r=$mysql->query($sql);	if($r and $valid){		$mysql->commit();		$mysql->autocommit(true);		sweetalert2($type="success",$msg="Hapus level berhasil",backendurl("$modul"));	} else {		$mysql->rollback();			sweetalert2($type="warning",$msg="Hapus level gagal",backendurl("$modul"));	}	}if($_POST['update_hak']==1) {	$mysql->autocommit(false);		$reset = $mysql->query("DELETE FROM hak_akses WHERE id_level = $id ");	$valid=true;	$msg=array();	foreach($master_hak_akses as $i => $v) {		if(count($_POST[$v['modul']])) {			foreach($_POST[$v['modul']] as $hak) {				$sql = "INSERT into hak_akses SET id_level =  $id, modul='".$v['modul']."', hak='".$hak."'";				$q=$mysql->query($sql);				if(!$q) {					$valid=false;					$msg[]=$v['modul']."', hak='".$hak."'";				}			}					}	}		if($valid){		$mysql->commit();		$mysql->autocommit(true);		sweetalert2($type="success",$msg="Konfigurasi hak akses berhasil",backendurl("$modul"));	} else {		$mysql->rollback();			sweetalert2($type="warning",$msg="Konfigurasi hak akses gagal ".join("|",$msg),backendurl("$modul"));	}	}?>